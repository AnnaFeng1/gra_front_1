import{_ as lt,r as y,a as F,o as rt,j as dt,c as f,d as n,L as ct,b as s,h as p,t as o,w as l,v as mt,k as H,u as ut,E as M,x as pt,y as vt,f as _,z as _t,g as v,l as k,A as K,e as ft,B as gt}from"./index-Bt0verpb.js";import{g as ht}from"./auth-C0OuI9IS.js";const yt={class:"dashboard-container"},wt={class:"main-content"},bt={class:"welcome-section"},Dt={class:"welcome-content"},Ct={class:"welcome-text"},kt={class:"content-container-vertical"},xt={class:"card-header"},Mt={class:"combined-content"},It={class:"camp-section"},St={class:"camp-info"},Tt={class:"camp-name-row"},Vt={class:"camp-name"},Nt={class:"camp-timeline-container"},zt={class:"camp-timeline"},Pt={class:"timeline-dates"},Lt={class:"start-date"},$t={class:"end-date"},Et={class:"timeline-track"},Bt={class:"camp-progress-info"},At={class:"progress-stat"},Ft={class:"progress-value"},Ut={class:"progress-stat"},Yt={class:"progress-value"},Rt={class:"camp-id-display"},Xt={class:"editable-camp-id"},jt={class:"camp-id-value"},qt={class:"camp-id-input-wrapper"},Ht={class:"camp-navigation"},Kt={class:"stats-section"},Wt={class:"stats-content"},Ot={class:"stat-item"},Gt={class:"stat-value"},Jt={class:"stat-item commission-item"},Qt={class:"stat-value"},Zt={class:"commission-detail-btn-wrapper"},ts={class:"card-header"},ss={class:"team-summary"},es={class:"team-stat"},as={class:"team-stat-value"},os={class:"team-stat"},ns={class:"team-stat-value"},is={class:"team-stat"},ls={class:"team-stat-value"},rs={class:"commission-header"},ds={class:"commission-info"},cs={class:"info-row"},ms={class:"info-value"},us={class:"info-row"},ps={class:"info-value"},vs={key:0,class:"info-row"},_s={class:"info-value"},fs={class:"info-row camp-id-input"},gs={class:"commission-total"},hs={class:"total-value"},ys={key:0,class:"loading-container"},ws={key:1,class:"commission-table-wrapper"},bs={key:0},Ds={class:"info-value"},Cs={key:1},ks={class:"info-value"},xs={key:2},Ms={class:"info-value"},Is={key:3},Ss={class:"info-value"},Ts={class:"commission-amount"},Vs={key:2,class:"empty-data"},Ns={class:"dialog-footer"},zs={__name:"LeaderDashboard",setup(Ps){const U=ut(),D=y("home"),g=y(!1),I=y(!1),Y=y({username:"加载中...",role:"leader"}),R=y(null),x=y(!1),c=y(1001),i=F({campId:"",campName:"加载中...",startDate:"",endDate:"",totalCommission:0,totalConversions:0}),C=F({memberCount:5,totalConversions:178,totalCommission:15680.5}),m=F({campId:"",campName:"",startDate:"",endDate:"",details:[]}),S=e=>{if(!e)return"暂无数据";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},T=e=>e==null?"0.00":Number(e).toFixed(2),W=async()=>{try{const e=await ht();e.code===1&&(Y.value=e.data)}catch(e){console.error("获取用户信息失败:",e),M.error("获取用户信息失败")}},B=async()=>{g.value=!0;try{const e=await pt(c.value);e.code===1?(i.campId=e.data.camp_id,i.campName=e.data.camp_name,i.startDate=e.data.start_date,i.endDate=e.data.end_date,i.totalCommission=e.data.total_commission,i.totalConversions=e.data.total_conversions):M.warning(e.msg||"获取业绩数据失败")}catch(e){console.error("获取业绩数据失败:",e),M.error("获取业绩数据失败，请稍后重试")}finally{g.value=!1}},A=async()=>{try{const e=await vt(c.value);e.code===1?(C.memberCount=e.data.member_count,C.totalConversions=e.data.success_count,C.totalCommission=e.data.total_commission):console.warn("获取团队数据失败:",e.msg)}catch(e){console.error("获取团队数据失败:",e)}},X=async e=>{I.value=!0;try{const t=await gt(e);t.code===1?(m.campId=t.data.camp_id,m.campName=t.data.camp_name,m.startDate=t.data.start_date,m.endDate=t.data.end_date,m.details=t.data.details||[]):M.warning(t.msg||"获取佣金明细失败")}catch(t){console.error("获取佣金明细失败:",t),M.error("获取佣金明细失败，请稍后重试")}finally{I.value=!1}},V=()=>{B(),A()},O=()=>{x.value=!0,X(c.value)},j=()=>{B(),A(),x.value&&X(c.value)},G=e=>{U.push(e),D.value="team"},J=()=>{G("/team-management")},Q=()=>{const e=R.value;if(!e)return;const t=e.getContext("2d"),r=[];let u=null;const w=()=>{const d=e.parentElement;e.width=d.offsetWidth,e.height=d.offsetHeight};window.addEventListener("resize",w),w();class z{constructor(){this.x=Math.random()*e.width,this.y=Math.random()*e.height,this.size=Math.random()*2+.5,this.speedX=Math.random()*.5-.25,this.speedY=Math.random()*.5-.25,this.color=`rgba(64, 158, 255, ${Math.random()*.4+.1})`}update(){(this.x>e.width||this.x<0)&&(this.speedX=-this.speedX),(this.y>e.height||this.y<0)&&(this.speedY=-this.speedY),this.x+=this.speedX,this.y+=this.speedY}draw(){t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.size,0,Math.PI*2),t.fill()}}const P=()=>{for(let d=0;d<15;d++)r.push(new z)},L=()=>{t.clearRect(0,0,e.width,e.height),r.forEach(d=>{d.update(),d.draw()}),b(),u=requestAnimationFrame(L)},b=()=>{for(let d=0;d<r.length;d++)for(let h=d+1;h<r.length;h++){const $=r[d].x-r[h].x,E=r[d].y-r[h].y,a=Math.sqrt($*$+E*E);a<100&&(t.beginPath(),t.strokeStyle=`rgba(64, 158, 255, ${.2-a/500})`,t.lineWidth=.8,t.moveTo(r[d].x,r[d].y),t.lineTo(r[h].x,r[h].y),t.stroke())}};return P(),L(),()=>{window.removeEventListener("resize",w),u&&cancelAnimationFrame(u)}},N=y(null);rt(()=>{W(),B(),A(),N.value=Q();const e=U.currentRoute.value.path;e==="/"?D.value="home":e.includes("team")?D.value="team":e.includes("commission")?D.value="commission":e.includes("customer")&&(D.value="customer")}),dt(()=>{N.value&&typeof N.value=="function"&&N.value()});const Z=e=>({ambassador_conversion:"success",leader_team_conversion:"primary",promotion_bonus_fixed:"warning",promotion_bonus_percentage:"danger"})[e]||"info",tt=e=>({ambassador_conversion:"直接推广佣金",leader_team_conversion:"团队推广佣金",promotion_bonus_fixed:"晋升固定奖励",promotion_bonus_percentage:"晋升比例奖励"})[e]||"未知类型",st=e=>({junior:"初级",intermediate:"中级",senior:"高级"})[e]||e,et=e=>{if(!e)return"暂无数据";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},q=()=>{if(!i.startDate||!i.endDate)return 0;const e=new Date(i.startDate),t=new Date(i.endDate),r=new Date;if(r<e)return 0;if(r>t)return 100;const u=Math.floor((t-e)/(1e3*60*60*24)),w=Math.floor((r-e)/(1e3*60*60*24));return Math.round(w/u*100)},at=()=>{if(!i.startDate)return 0;const e=new Date(i.startDate),t=new Date;return t<e?0:Math.max(0,Math.floor((t-e)/(1e3*60*60*24)))},ot=()=>{if(!i.endDate)return 0;const e=new Date(i.endDate),t=new Date;return t>e?0:Math.max(0,Math.floor((e-t)/(1e3*60*60*24)))},nt=()=>{g.value||(c.value--,V(c.value))},it=()=>{g.value||(c.value++,V(c.value))};return(e,t)=>{const r=_("el-tag"),u=_("el-button"),w=_("el-button-group"),z=_("el-input"),P=_("el-card"),L=_("el-skeleton"),b=_("el-table-column"),d=_("el-table"),h=_("el-empty"),$=_("el-dialog"),E=_t("loading");return v(),f("div",yt,[n(ct,{activePage:D.value},null,8,["activePage"]),s("div",wt,[s("div",bt,[s("canvas",{ref_key:"welcomeCanvas",ref:R,class:"welcome-canvas"},null,512),s("div",Dt,[s("h2",Ct,[p("欢迎，"+o(Y.value.username)+" ",1),n(r,{type:"warning"},{default:l(()=>t[4]||(t[4]=[p("大使长")])),_:1})])])]),s("div",kt,[mt((v(),H(P,{class:"combined-card"},{header:l(()=>[s("div",xt,[t[6]||(t[6]=s("span",null,[s("i",{class:"el-icon-date"}),p(" 营期与业绩")],-1)),g.value?k("",!0):(v(),H(w,{key:0},{default:l(()=>[n(u,{size:"small",type:"primary",onClick:j},{default:l(()=>t[5]||(t[5]=[s("i",{class:"el-icon-refresh-right"},null,-1),p(" 刷新数据 ")])),_:1})]),_:1}))])]),default:l(()=>[s("div",Mt,[s("div",It,[t[14]||(t[14]=s("h3",{class:"section-title"},"当前营期",-1)),s("div",St,[s("div",Tt,[s("span",Vt,o(i.campName),1)]),s("div",Nt,[s("div",zt,[s("div",Pt,[s("span",Lt,o(S(i.startDate)),1),s("span",$t,o(S(i.endDate)),1)]),s("div",Et,[s("div",{class:"timeline-progress",style:K({width:q()+"%"})},null,4),s("div",{class:"timeline-indicator",style:K({left:q()+"%"})},null,4)])])]),s("div",Bt,[s("div",At,[t[7]||(t[7]=s("span",{class:"progress-label"},"已进行:",-1)),s("span",Ft,o(at())+"天",1)]),t[10]||(t[10]=s("div",{class:"progress-divider"},null,-1)),s("div",Ut,[t[8]||(t[8]=s("span",{class:"progress-label"},"剩余:",-1)),s("span",Yt,o(ot())+"天",1)]),t[11]||(t[11]=s("div",{class:"progress-divider"},null,-1)),s("div",Rt,[t[9]||(t[9]=s("span",{class:"camp-id-label"},"营期ID:",-1)),s("div",Xt,[s("span",jt,o(c.value),1),s("div",qt,[n(z,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=a=>c.value=a),size:"small",onBlur:V,onKeyup:ft(V,["enter"]),class:"camp-id-input-hover"},null,8,["modelValue"])])])])]),s("div",Ht,[n(u,{class:"camp-nav-btn prev-btn",disabled:g.value,onClick:nt,icon:"el-icon-arrow-left"},{default:l(()=>t[12]||(t[12]=[p(" 上一营期 ")])),_:1},8,["disabled"]),n(u,{class:"camp-nav-btn next-btn",disabled:g.value,onClick:it,icon:"el-icon-arrow-right"},{default:l(()=>t[13]||(t[13]=[p(" 下一营期 ")])),_:1},8,["disabled"])])])]),t[22]||(t[22]=s("div",{class:"section-divider"},null,-1)),s("div",Kt,[t[21]||(t[21]=s("h3",{class:"section-title"},"个人业绩数据",-1)),s("div",Wt,[s("div",Ot,[t[15]||(t[15]=s("div",{class:"stat-title"},"成功推广数",-1)),s("div",Gt,o(i.totalConversions||0),1),t[16]||(t[16]=s("div",{class:"stat-desc"},"本营期推广",-1))]),t[20]||(t[20]=s("div",{class:"stat-divider"},null,-1)),s("div",Jt,[t[18]||(t[18]=s("div",{class:"stat-title"},"佣金总额",-1)),s("div",Qt,"¥"+o(T(i.totalCommission)),1),t[19]||(t[19]=s("div",{class:"stat-desc"},"累计收益",-1)),s("div",Zt,[n(u,{type:"primary",size:"default",class:"commission-detail-btn",onClick:O},{default:l(()=>t[17]||(t[17]=[s("i",{class:"el-icon-document"},null,-1),p(" 佣金明细 ")])),_:1})])])])])])]),_:1})),[[E,g.value]]),n(P,{class:"team-card"},{header:l(()=>[s("div",ts,[t[24]||(t[24]=s("span",null,[s("i",{class:"el-icon-s-custom"}),p(" 团队管理")],-1)),n(u,{type:"primary",size:"small",onClick:J},{default:l(()=>t[23]||(t[23]=[s("i",{class:"el-icon-s-unfold"},null,-1),p(" 进入团队管理 ")])),_:1})])]),default:l(()=>[s("div",ss,[t[31]||(t[31]=s("h3",{class:"section-title"},"团队数据概览",-1)),s("div",es,[t[25]||(t[25]=s("div",{class:"team-stat-title"},"团队成员",-1)),s("div",as,o(C.memberCount||0),1),t[26]||(t[26]=s("div",{class:"team-stat-desc"},"在册推广大使",-1))]),s("div",os,[t[27]||(t[27]=s("div",{class:"team-stat-title"},"团队业绩",-1)),s("div",ns,o(C.totalConversions||0),1),t[28]||(t[28]=s("div",{class:"team-stat-desc"},"总转化数量",-1))]),s("div",is,[t[29]||(t[29]=s("div",{class:"team-stat-title"},"团队佣金",-1)),s("div",ls,"¥"+o(T(C.totalCommission)),1),t[30]||(t[30]=s("div",{class:"team-stat-desc"},"总佣金金额",-1))])])]),_:1})])]),n($,{modelValue:x.value,"onUpdate:modelValue":t[3]||(t[3]=a=>x.value=a),title:"佣金明细",width:"900px",class:"commission-dialog","close-on-click-modal":!1,"destroy-on-close":""},{footer:l(()=>[s("span",Ns,[n(u,{type:"primary",onClick:t[2]||(t[2]=a=>x.value=!1)},{default:l(()=>t[42]||(t[42]=[p("关闭")])),_:1})])]),default:l(()=>[s("div",rs,[s("div",ds,[s("div",cs,[t[32]||(t[32]=s("span",{class:"info-label"},"营期ID:",-1)),s("span",ms,o(m.campId||c.value),1)]),s("div",us,[t[33]||(t[33]=s("span",{class:"info-label"},"营期名称:",-1)),s("span",ps,o(m.campName||i.campName),1)]),m.startDate&&m.endDate?(v(),f("div",vs,[t[34]||(t[34]=s("span",{class:"info-label"},"营期时间:",-1)),s("span",_s,o(S(m.startDate))+" 至 "+o(S(m.endDate)),1)])):k("",!0),s("div",fs,[t[36]||(t[36]=s("span",{class:"info-label"},"切换营期:",-1)),n(z,{modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=a=>c.value=a),size:"small",style:{width:"120px"},placeholder:"营期ID",type:"number"},null,8,["modelValue"]),n(u,{size:"small",type:"primary",onClick:j,style:{"margin-left":"10px"},loading:I.value},{default:l(()=>t[35]||(t[35]=[p("刷新")])),_:1},8,["loading"])])]),s("div",gs,[t[37]||(t[37]=s("span",{class:"total-label"},"总佣金:",-1)),s("span",hs," ￥"+o(T(i.totalCommission)),1)])]),I.value?(v(),f("div",ys,[n(L,{rows:5,animated:""})])):m.details&&m.details.length>0?(v(),f("div",ws,[n(d,{data:m.details,style:{width:"100%"},border:"",stripe:"","max-height":"400",class:"commission-table"},{default:l(()=>[n(b,{prop:"commission_id",label:"ID",width:"80",align:"center"}),n(b,{label:"佣金类型",width:"150",align:"center"},{default:l(a=>[n(r,{type:Z(a.row.commission_type)},{default:l(()=>[p(o(tt(a.row.commission_type)),1)]),_:2},1032,["type"])]),_:1}),n(b,{label:"相关信息","min-width":"180"},{default:l(a=>[a.row.promoted_ambassador_id?(v(),f("div",bs,[t[38]||(t[38]=s("span",{class:"info-key"},"晋升推广大使ID:",-1)),s("span",Ds,o(a.row.promoted_ambassador_id),1)])):k("",!0),a.row.order_id?(v(),f("div",Cs,[t[39]||(t[39]=s("span",{class:"info-key"},"订单ID:",-1)),s("span",ks,o(a.row.order_id),1)])):k("",!0),a.row.customer_id?(v(),f("div",xs,[t[40]||(t[40]=s("span",{class:"info-key"},"客户ID:",-1)),s("span",Ms,o(a.row.customer_id),1)])):k("",!0),a.row.tier?(v(),f("div",Is,[t[41]||(t[41]=s("span",{class:"info-key"},"佣金层级:",-1)),s("span",Ss,o(st(a.row.tier)),1)])):k("",!0)]),_:1}),n(b,{prop:"commission_amount",label:"佣金金额",width:"120",align:"right"},{default:l(a=>[s("span",Ts,"¥"+o(T(a.row.commission_amount)),1)]),_:1}),n(b,{prop:"created_time",label:"创建时间",width:"170",align:"center"},{default:l(a=>[p(o(et(a.row.created_time)),1)]),_:1})]),_:1},8,["data"])])):(v(),f("div",Vs,[n(h,{description:"暂无佣金明细数据"})]))]),_:1},8,["modelValue"])])}}},Es=lt(zs,[["__scopeId","data-v-ff281757"]]);export{Es as default};
