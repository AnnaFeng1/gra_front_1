import{_ as h,r as g,a as I,o as k,c as x,b as l,d as r,w as t,e as S,f as i,g as U,h as v,t as R,u as N,E as p}from"./index-Bt0verpb.js";import{l as B,g as C}from"./auth-C0OuI9IS.js";const E={class:"login-container"},F={class:"login-box"},L={class:"login-options"},M={__name:"Login",setup(q){const m=N(),n=g(!1),c=g(!1),o=I({username:"",password:""}),b={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6个字符",trigger:"blur"}]},f=g(null),_=async()=>{if(!n.value){if(!f.value){console.error("登录表单引用不存在");return}f.value.validate(async u=>{if(u)try{n.value=!0;const e=await B(o.username,o.password);if(e.code===1){localStorage.setItem("token",e.data),c.value?localStorage.setItem("rememberedUsername",o.username):localStorage.removeItem("rememberedUsername");const a=await C();if(a.code===1){const s=a.data.role;localStorage.setItem("userRole",s),localStorage.setItem("userInfo",JSON.stringify(a.data)),p.success("登录成功"),s==="admin"?m.push("/admin-dashboard"):s==="leader"?m.push("/leader-dashboard"):s==="ambassador"?m.push("/dashboard"):m.push("/")}else p.error("获取用户信息失败"),localStorage.removeItem("token")}else p.error(e.msg||"登录失败，请检查用户名和密码")}catch(e){console.error("登录失败:",e),p.error("登录失败，请稍后重试")}finally{n.value=!1}})}};return k(()=>{const u=localStorage.getItem("rememberedUsername");u&&(o.username=u,c.value=!0)}),(u,e)=>{const a=i("el-input"),s=i("el-form-item"),w=i("el-checkbox"),y=i("el-button"),V=i("el-form");return U(),x("div",E,[l("div",F,[e[5]||(e[5]=l("div",{class:"login-header"},[l("div",{class:"logo"},"营销推广管理系统"),l("div",{class:"subtitle"},"欢迎登录")],-1)),r(V,{ref_key:"loginFormRef",ref:f,model:o,rules:b,class:"login-form",onKeyup:S(_,["enter"])},{default:t(()=>[r(s,{prop:"username"},{default:t(()=>[r(a,{modelValue:o.username,"onUpdate:modelValue":e[0]||(e[0]=d=>o.username=d),placeholder:"请输入用户名","prefix-icon":"el-icon-user",clearable:"",autofocus:""},null,8,["modelValue"])]),_:1}),r(s,{prop:"password"},{default:t(()=>[r(a,{modelValue:o.password,"onUpdate:modelValue":e[1]||(e[1]=d=>o.password=d),type:"password",placeholder:"请输入密码","prefix-icon":"el-icon-lock","show-password":""},null,8,["modelValue"])]),_:1}),l("div",L,[r(w,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=d=>c.value=d)},{default:t(()=>e[3]||(e[3]=[v("记住我")])),_:1},8,["modelValue"]),e[4]||(e[4]=l("a",{href:"#",class:"forget-link"},"忘记密码?",-1))]),r(s,null,{default:t(()=>[r(y,{loading:n.value,type:"primary",class:"login-button",onClick:_},{default:t(()=>[v(R(n.value?"登录中...":"登录"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])}}},J=h(M,[["__scopeId","data-v-3a8049ef"]]);export{J as default};
