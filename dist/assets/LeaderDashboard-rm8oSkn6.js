import{s as Y,u as j,r as y,a as A,o as O,k as G,c as V,d,b as t,h as c,t as i,p as J,w as l,x as K,l as F,E as L,f as v,y as Q,g as h,m as U,i as Z}from"./index-nCsIEKc5.js";import{T as ss}from"./TheHeader-DUIFwaDE.js";import{_ as ts}from"./_plugin-vue_export-helper-DlAUqK2U.js";function es(b=1001){return Y({url:"/api/leader/performance/statistics",method:"get",params:{camp_id:b}})}function os(b=1001){return Y({url:"/api/leader/team/overview",method:"get",params:{camp_id:b}})}const as={class:"dashboard-container"},ns={class:"main-content"},is={class:"welcome-section"},ls={class:"welcome-content"},ds={class:"welcome-text"},rs={class:"content-container-vertical"},ms={class:"card-header"},cs={class:"combined-content"},us={class:"camp-section"},vs={class:"camp-info"},ps={class:"info-item"},fs={class:"info-value camp-name"},_s={class:"info-item"},hs={class:"info-value"},gs={class:"info-item"},ys={class:"camp-id-selector"},bs={class:"stats-section"},ws={class:"stats-content"},Cs={class:"stat-item"},Ds={class:"stat-value"},xs={class:"stat-item commission-item"},ks={class:"stat-value"},Vs={class:"commission-detail-btn-wrapper"},Ms={class:"card-header"},zs={class:"team-summary"},Ss={class:"team-stat"},Ns={class:"team-stat-value"},Ts={class:"team-stat"},Is={class:"team-stat-value"},Ps={class:"team-stat"},Es={class:"team-stat-value"},$s={class:"commission-header"},As={class:"commission-info"},Fs={class:"info-row"},Ls={class:"info-value"},Us={key:0,class:"info-row"},Ys={class:"info-value"},Bs={class:"info-row camp-id-input"},Xs={class:"commission-total"},qs={class:"total-value"},Hs={key:0,class:"loading-container"},Rs={key:1,class:"dialog-loading"},Ws={class:"dialog-footer"},js={__name:"LeaderDashboard",setup(b){const B=Z(),X=j(),f=y(!1),I=y(null),w=y(!1),p=y(1001),a=A({campId:"",campName:"加载中...",startDate:"",endDate:"",totalCommission:0,totalConversions:0}),_=A({memberCount:5,totalConversions:178,totalCommission:15680.5}),C=e=>{if(!e)return"暂无数据";const s=new Date(e);return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`},M=e=>e==null?"0.00":Number(e).toFixed(2),z=async()=>{f.value=!0;try{const e=await es(p.value);e.code===1?(a.campId=e.data.camp_id,a.campName=e.data.camp_name,a.startDate=e.data.start_date,a.endDate=e.data.end_date,a.totalCommission=e.data.total_commission,a.totalConversions=e.data.total_conversions):L.warning(e.msg||"获取业绩数据失败")}catch(e){console.error("获取业绩数据失败:",e),L.error("获取业绩数据失败，请稍后重试")}finally{f.value=!1}},S=async()=>{try{const e=await os(p.value);e.code===1?(_.memberCount=e.data.member_count,_.totalConversions=e.data.success_count,_.totalCommission=e.data.total_commission):console.warn("获取团队数据失败:",e.msg)}catch(e){console.error("获取团队数据失败:",e)}},q=()=>{z(),S()},H=()=>{w.value=!0},P=()=>{z(),S()},R=()=>{B.push("/team-management")},W=()=>{const e=I.value;if(!e)return;const s=e.getContext("2d"),n=[];let r=null;const g=()=>{const o=e.parentElement;e.width=o.offsetWidth,e.height=o.offsetHeight};window.addEventListener("resize",g),g();class N{constructor(){this.x=Math.random()*e.width,this.y=Math.random()*e.height,this.size=Math.random()*3+1,this.speedX=Math.random()*1-.5,this.speedY=Math.random()*1-.5,this.color=`rgba(255, 182, 64, ${Math.random()*.5+.1})`}update(){(this.x>e.width||this.x<0)&&(this.speedX=-this.speedX),(this.y>e.height||this.y<0)&&(this.speedY=-this.speedY),this.x+=this.speedX,this.y+=this.speedY}draw(){s.fillStyle=this.color,s.beginPath(),s.arc(this.x,this.y,this.size,0,Math.PI*2),s.fill()}}const x=()=>{for(let o=0;o<15;o++)n.push(new N)},k=()=>{s.clearRect(0,0,e.width,e.height),n.forEach(o=>{o.update(),o.draw()}),T(),r=requestAnimationFrame(k)},T=()=>{for(let o=0;o<n.length;o++)for(let u=o+1;u<n.length;u++){const m=n[o].x-n[u].x,E=n[o].y-n[u].y,$=Math.sqrt(m*m+E*E);$<100&&(s.beginPath(),s.strokeStyle=`rgba(255, 182, 64, ${.2-$/500})`,s.lineWidth=.8,s.moveTo(n[o].x,n[o].y),s.lineTo(n[u].x,n[u].y),s.stroke())}};return x(),k(),()=>{window.removeEventListener("resize",g),r&&cancelAnimationFrame(r)}},D=y(null);return O(()=>{z(),S(),D.value=W()}),G(()=>{D.value&&typeof D.value=="function"&&D.value()}),(e,s)=>{const n=v("el-tag"),r=v("el-button"),g=v("el-button-group"),N=v("el-input-number"),x=v("el-card"),k=v("el-input"),T=v("el-icon"),o=v("el-dialog"),u=Q("loading");return h(),V("div",as,[d(ss),t("div",ns,[t("div",is,[t("canvas",{ref_key:"welcomeCanvas",ref:I,class:"welcome-canvas"},null,512),t("div",ls,[t("h2",ds,[c("欢迎，"+i(J(X).username)+" ",1),d(n,{type:"warning"},{default:l(()=>s[4]||(s[4]=[c("大使长")])),_:1})]),s[5]||(s[5]=t("p",{class:"welcome-subtitle"},"您的团队管理中心",-1))])]),t("div",rs,[K((h(),F(x,{class:"combined-card"},{header:l(()=>[t("div",ms,[s[7]||(s[7]=t("span",null,[t("i",{class:"el-icon-date"}),c(" 营期与业绩")],-1)),f.value?U("",!0):(h(),F(g,{key:0},{default:l(()=>[d(r,{size:"small",type:"primary",onClick:P},{default:l(()=>s[6]||(s[6]=[t("i",{class:"el-icon-refresh-right"},null,-1),c(" 刷新数据 ")])),_:1})]),_:1}))])]),default:l(()=>[t("div",cs,[t("div",us,[s[11]||(s[11]=t("h3",{class:"section-title"},"当前营期",-1)),t("div",vs,[t("div",ps,[s[8]||(s[8]=t("span",{class:"info-label"},"营期名称:",-1)),t("span",fs,i(a.campName),1)]),t("div",_s,[s[9]||(s[9]=t("span",{class:"info-label"},"营期时间:",-1)),t("span",hs,i(C(a.startDate))+" 至 "+i(C(a.endDate)),1)]),t("div",gs,[s[10]||(s[10]=t("span",{class:"info-label"},"营期ID:",-1)),t("div",ys,[d(N,{modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=m=>p.value=m),min:1e3,size:"small",onChange:q,disabled:f.value},null,8,["modelValue","disabled"])])])])]),s[19]||(s[19]=t("div",{class:"section-divider"},null,-1)),t("div",bs,[s[18]||(s[18]=t("h3",{class:"section-title"},"个人业绩数据",-1)),t("div",ws,[t("div",Cs,[s[12]||(s[12]=t("div",{class:"stat-title"},"成功推广数",-1)),t("div",Ds,i(a.totalConversions||0),1),s[13]||(s[13]=t("div",{class:"stat-desc"},"本营期推广",-1))]),s[17]||(s[17]=t("div",{class:"stat-divider"},null,-1)),t("div",xs,[s[15]||(s[15]=t("div",{class:"stat-title"},"佣金总额",-1)),t("div",ks,"¥"+i(M(a.totalCommission)),1),s[16]||(s[16]=t("div",{class:"stat-desc"},"累计收益",-1)),t("div",Vs,[d(r,{type:"primary",size:"default",class:"commission-detail-btn",onClick:H},{default:l(()=>s[14]||(s[14]=[t("i",{class:"el-icon-document"},null,-1),c(" 佣金明细 ")])),_:1})])])])])])]),_:1})),[[u,f.value]]),d(x,{class:"team-card"},{header:l(()=>[t("div",Ms,[s[21]||(s[21]=t("span",null,[t("i",{class:"el-icon-s-custom"}),c(" 团队管理")],-1)),d(r,{type:"primary",size:"small",onClick:R},{default:l(()=>s[20]||(s[20]=[t("i",{class:"el-icon-s-unfold"},null,-1),c(" 进入团队管理 ")])),_:1})])]),default:l(()=>[t("div",zs,[t("div",Ss,[s[22]||(s[22]=t("div",{class:"team-stat-title"},"团队成员",-1)),t("div",Ns,i(_.memberCount||0),1),s[23]||(s[23]=t("div",{class:"team-stat-desc"},"在册推广大使",-1))]),t("div",Ts,[s[24]||(s[24]=t("div",{class:"team-stat-title"},"团队业绩",-1)),t("div",Is,i(_.totalConversions||0),1),s[25]||(s[25]=t("div",{class:"team-stat-desc"},"总转化数量",-1))]),t("div",Ps,[s[26]||(s[26]=t("div",{class:"team-stat-title"},"团队佣金",-1)),t("div",Es,"¥"+i(M(_.totalCommission)),1),s[27]||(s[27]=t("div",{class:"team-stat-desc"},"总佣金金额",-1))])])]),_:1})])]),d(o,{modelValue:w.value,"onUpdate:modelValue":s[3]||(s[3]=m=>w.value=m),title:"佣金明细",width:"750px",class:"commission-dialog","close-on-click-modal":!1,"destroy-on-close":""},{footer:l(()=>[t("span",Ws,[d(r,{type:"primary",onClick:s[2]||(s[2]=m=>w.value=!1)},{default:l(()=>s[36]||(s[36]=[c("关闭")])),_:1})])]),default:l(()=>[t("div",$s,[t("div",As,[s[32]||(s[32]=t("div",{class:"info-row"},[t("span",{class:"info-label"},"佣金类型:"),t("span",{class:"info-value"},"直接转化佣金")],-1)),t("div",Fs,[s[28]||(s[28]=t("span",{class:"info-label"},"当前营期:",-1)),t("span",Ls,i(a.campName||`营期${p.value}`),1)]),a.startDate||a.endDate?(h(),V("div",Us,[s[29]||(s[29]=t("span",{class:"info-label"},"营期时间:",-1)),t("span",Ys,i(C(a.startDate))+" 至 "+i(C(a.endDate)),1)])):U("",!0),t("div",Bs,[s[31]||(s[31]=t("span",{class:"info-label"},"营期ID:",-1)),d(k,{modelValue:p.value,"onUpdate:modelValue":s[1]||(s[1]=m=>p.value=m),size:"small",style:{width:"120px"},placeholder:"营期ID",type:"number"},null,8,["modelValue"]),d(r,{size:"small",type:"primary",onClick:P,style:{"margin-left":"10px"}},{default:l(()=>s[30]||(s[30]=[c("刷新")])),_:1})])]),t("div",Xs,[s[33]||(s[33]=t("span",{class:"total-label"},"总佣金:",-1)),t("span",qs," ￥"+i(M(a.totalCommission)),1)])]),f.value?(h(),V("div",Hs,[d(T,{class:"is-loading"}),s[34]||(s[34]=t("span",null,"正在加载数据...",-1))])):(h(),V("div",Rs,s[35]||(s[35]=[t("p",null,"佣金明细功能开发中...",-1)])))]),_:1},8,["modelValue"])])}}},Ks=ts(js,[["__scopeId","data-v-b395a5be"]]);export{Ks as default};
