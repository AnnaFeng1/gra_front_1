const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/installCanvasRenderer-9PKGsH8D.js","assets/index-Bt0verpb.js","assets/index-B0ywRIfq.css"])))=>i.map(i=>d[i]);
import{A as Ta}from"./AdminNavBar-B2tiYlU-.js";import{a2 as za,a3 as Ma,a4 as Fa,a5 as La,a6 as Ra,L as Ia,O as Ua,N as Pa,Q as ja,U as Ea,T as Oa,R as Ka,V as Wa,a7 as Ba,a8 as Ee,a9 as Oe,aa as Qa,ab as Ha,ac as qa,ad as Ya,ae as Na,af as Ga,ag as Xa,a0 as Ke}from"./installCanvasRenderer-9PKGsH8D.js";import{_ as Le,r,a as Fe,o as Re,N as He,O as qe,P as Ye,f as C,z as Ne,g as k,c as E,b as t,d as l,w as o,h as i,e as Za,v as me,k as N,t as f,l as Q,F as Ge,Q as Xe,E as S,R as Y,S as be,T as We,G as Ja,U as $a,V as el,W as al,X as ll,Y as ol,M as tl,D as nl,C as sl,Z as il,n as ue,j as rl}from"./index-Bt0verpb.js";const dl={name:"IndividualAmbassadorManagement",setup(){const D=r([]),e=r(!1),O=r(0),a=r(1),F=r(10),L=r(""),y=r("id"),h=r("desc"),d=r(null),w=r(!1),T=r(!1),R=r("add"),A=Fe({username:"",password:"",email:"",phone:""}),p={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度需在3到20个字符之间",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,message:"密码长度不能少于8个字符",trigger:"blur"}],email:[{type:"email",message:"请输入正确的电子邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]},V=r(!1),I=r(!1),z=r(null),c=r(!1),K=r(null),J=r(!1),g=async()=>{e.value=!0;const v={page:a.value,size:F.value,sort_field:y.value,sort_order:h.value};L.value&&L.value.trim()!==""&&(v.keyword=L.value.trim()),console.log("开始请求独立推广大使列表数据，参数:",v);try{const M=await za(v);if(console.log("获取独立推广大使列表响应:",M),!M.data){S.warning("API返回了成功状态，但没有数据"),D.value=[],O.value=0;return}const b=M.data;if(console.log("响应中的data字段:",b),Array.isArray(b))D.value=b,O.value=b.length;else if(b.records)D.value=b.records,O.value=b.total||b.records.length,a.value=b.current||a.value;else if(b.list)D.value=b.list,O.value=b.total||b.list.length,a.value=b.current||a.value;else{console.warn("未知的数据结构:",b);const ee=Object.keys(b).filter(X=>Array.isArray(b[X])&&b[X].length>0);if(ee.length>0){const X=ee[0];console.log(`尝试使用 ${X} 作为列表字段`),D.value=b[X],O.value=D.value.length}else S.warning("无法识别的数据结构，显示空列表"),D.value=[],O.value=0}console.log("成功解析数据，获取到记录数:",D.value.length)}catch(M){console.error("获取独立推广大使列表失败:",M),D.value=[],O.value=0}finally{e.value=!1}},$=v=>{v.stopPropagation()};Re(()=>{g()});const W=v=>{a.value=v,g()},U=v=>{F.value=v,a.value=1,g()},te=({prop:v,order:M})=>{y.value=v||"id",h.value=M==="ascending"?"asc":"desc",g()},B=()=>{a.value=1,g()},ne=()=>{R.value="add",P(),w.value=!0},P=()=>{d.value&&d.value.resetFields(),Object.assign(A,{username:"",password:"",email:"",phone:""})};return{Search:He,Refresh:qe,Plus:Ye,searchKeyword:L,handleSearch:B,ambassadorList:D,loading:e,total:O,currentPage:a,pageSize:F,handleCurrentChange:W,handleSizeChange:U,handleSortChange:te,loadData:g,formRef:d,formVisible:w,formData:A,formRules:p,dialogType:R,submitting:T,handleAddAmbassador:ne,resetForm:P,submitForm:async()=>{d.value&&d.value.validate(async v=>{if(v){T.value=!0;try{let M;if(R.value==="add"){const b={username:A.username,password:A.password};A.email&&(b.email=A.email),A.phone&&(b.phone=A.phone),M=await La(b),S.success("添加推广大使成功")}else{const b={username:A.username};A.email&&(b.email=A.email),A.phone&&(b.phone=A.phone),A.password&&(b.password=A.password),M=await Ra(A.id,b),S.success("更新推广大使成功")}w.value=!1,g()}catch(M){console.error(`${R.value==="add"?"添加":"更新"}推广大使失败:`,M)}finally{T.value=!1}}else return S.warning("请正确填写表单信息"),!1})},formatDate:v=>{if(!v)return"";const M=new Date(v),b=M.getFullYear(),ee=String(M.getMonth()+1).padStart(2,"0"),X=String(M.getDate()).padStart(2,"0"),re=String(M.getHours()).padStart(2,"0"),_e=String(M.getMinutes()).padStart(2,"0");return`${b}-${ee}-${X} ${re}:${_e}`},formatCurrency:v=>v==null?"0.00":parseFloat(v).toFixed(2),detailVisible:V,detailLoading:I,ambassadorDetail:z,handleViewDetails:async v=>{V.value=!0,I.value=!0,z.value=null;try{const M=await Ma(v.id);z.value=M.data}catch(M){console.error("获取推广大使详情失败:",M)}finally{I.value=!1}},handleEditFromDetail:()=>{z.value&&(V.value=!1,R.value="edit",P(),Object.assign(A,{id:z.value.id,username:z.value.username,email:z.value.email||"",phone:z.value.phone||"",password:""}),w.value=!0)},handleEdit:v=>{R.value="edit",P(),Object.assign(A,{id:v.id,username:v.username,email:v.email||"",phone:v.phone||"",password:""}),w.value=!0},deleteVisible:c,ambassadorToDelete:K,deleting:J,handleDelete:v=>{K.value=v,c.value=!0},confirmDelete:async()=>{if(K.value){J.value=!0;try{await Fa(K.value.id),S.success("删除推广大使成功"),c.value=!1,g()}catch(v){console.error("删除推广大使失败:",v)}finally{J.value=!1}}},handleWheel:$}}},ml={class:"header-card"},ul={class:"title-area"},cl={class:"button-group"},fl={class:"search-area"},vl={class:"table-card"},pl={class:"action-buttons-group"},gl={class:"pagination-card"},bl={class:"dialog-footer"},_l={class:"detail-container"},yl={class:"detail-section"},hl={class:"detail-section"},wl={class:"detail-section"},Cl={class:"dialog-footer"},Dl={class:"delete-confirm-content"},kl={class:"dialog-footer"};function Vl(D,e,O,a,F,L){const y=C("el-button"),h=C("el-input"),d=C("el-table-column"),w=C("el-table"),T=C("el-pagination"),R=C("el-form-item"),A=C("el-form"),p=C("el-dialog"),V=C("el-descriptions-item"),I=C("el-descriptions"),z=Ne("loading");return k(),E("div",{class:"individual-ambassador-management",onWheel:e[11]||(e[11]=Xe(()=>{},["stop"]))},[t("div",ml,[t("div",ul,[e[14]||(e[14]=t("h2",null,"独立推广大使管理",-1)),t("div",cl,[l(y,{type:"info",icon:a.Refresh,onClick:a.loadData,loading:a.loading},{default:o(()=>e[12]||(e[12]=[i("刷新")])),_:1},8,["icon","onClick","loading"]),l(y,{type:"primary",icon:a.Plus,onClick:a.handleAddAmbassador},{default:o(()=>e[13]||(e[13]=[i("添加推广大使")])),_:1},8,["icon","onClick"])])]),t("div",fl,[l(h,{modelValue:a.searchKeyword,"onUpdate:modelValue":e[0]||(e[0]=c=>a.searchKeyword=c),placeholder:"搜索用户名/邮箱/电话","prefix-icon":a.Search,clearable:"",onClear:a.loadData,onKeyup:Za(a.handleSearch,["enter","native"])},{append:o(()=>[l(y,{icon:a.Search,onClick:a.handleSearch},null,8,["icon","onClick"])]),_:1},8,["modelValue","prefix-icon","onClear","onKeyup"])])]),t("div",vl,[me((k(),N(w,{data:a.ambassadorList,style:{width:"100%"},onSortChange:a.handleSortChange,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"cell-style":{padding:"12px 0"}},{default:o(()=>[l(d,{prop:"id",label:"ID",width:"80",sortable:"custom"}),l(d,{prop:"username",label:"用户名",sortable:"custom"}),l(d,{prop:"email",label:"电子邮箱","min-width":"180"}),l(d,{prop:"phone",label:"电话","min-width":"140"}),l(d,{prop:"created_at",label:"创建时间","min-width":"180",sortable:"custom"},{default:o(c=>[i(f(a.formatDate(c.row.created_at)),1)]),_:1}),l(d,{prop:"conversions",label:"转化数",width:"100",align:"center",sortable:"custom"}),l(d,{prop:"commission",label:"总佣金(元)","min-width":"120",align:"right",sortable:"custom"},{default:o(c=>[i(f(a.formatCurrency(c.row.commission)),1)]),_:1}),l(d,{label:"操作",width:"220",fixed:"right"},{default:o(c=>[t("div",pl,[l(y,{type:"primary",size:"small",plain:"",onClick:K=>a.handleViewDetails(c.row)},{default:o(()=>e[15]||(e[15]=[i("查看")])),_:2},1032,["onClick"]),l(y,{type:"warning",size:"small",plain:"",onClick:K=>a.handleEdit(c.row)},{default:o(()=>e[16]||(e[16]=[i("编辑")])),_:2},1032,["onClick"]),l(y,{type:"danger",size:"small",plain:"",onClick:K=>a.handleDelete(c.row)},{default:o(()=>e[17]||(e[17]=[i("删除")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data","onSortChange"])),[[z,a.loading]])]),t("div",gl,[l(T,{background:"",onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange,"current-page":a.currentPage,"page-sizes":[10,20,50],"page-size":a.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:a.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])]),l(p,{title:a.dialogType==="add"?"添加独立推广大使":"编辑独立推广大使",modelValue:a.formVisible,"onUpdate:modelValue":e[6]||(e[6]=c=>a.formVisible=c),width:"500px",onClosed:a.resetForm,"destroy-on-close":""},{footer:o(()=>[t("span",bl,[l(y,{onClick:e[5]||(e[5]=c=>a.formVisible=!1)},{default:o(()=>e[18]||(e[18]=[i("取消")])),_:1}),l(y,{type:"primary",onClick:a.submitForm,loading:a.submitting},{default:o(()=>e[19]||(e[19]=[i("提交")])),_:1},8,["onClick","loading"])])]),default:o(()=>[l(A,{ref:"formRef",model:a.formData,rules:a.formRules,"label-width":"100px","label-position":"right",class:"ambassador-form"},{default:o(()=>[l(R,{label:"用户名",prop:"username"},{default:o(()=>[l(h,{modelValue:a.formData.username,"onUpdate:modelValue":e[1]||(e[1]=c=>a.formData.username=c),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a.dialogType==="add"?(k(),N(R,{key:0,label:"密码",prop:"password"},{default:o(()=>[l(h,{modelValue:a.formData.password,"onUpdate:modelValue":e[2]||(e[2]=c=>a.formData.password=c),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})):Q("",!0),l(R,{label:"电子邮箱",prop:"email"},{default:o(()=>[l(h,{modelValue:a.formData.email,"onUpdate:modelValue":e[3]||(e[3]=c=>a.formData.email=c),placeholder:"请输入电子邮箱"},null,8,["modelValue"])]),_:1}),l(R,{label:"电话",prop:"phone"},{default:o(()=>[l(h,{modelValue:a.formData.phone,"onUpdate:modelValue":e[4]||(e[4]=c=>a.formData.phone=c),placeholder:"请输入电话号码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onClosed"]),l(p,{title:"推广大使详情",modelValue:a.detailVisible,"onUpdate:modelValue":e[8]||(e[8]=c=>a.detailVisible=c),width:"600px","destroy-on-close":""},{footer:o(()=>[t("span",Cl,[l(y,{onClick:e[7]||(e[7]=c=>a.detailVisible=!1)},{default:o(()=>e[23]||(e[23]=[i("关闭")])),_:1}),l(y,{type:"warning",plain:"",onClick:a.handleEditFromDetail},{default:o(()=>e[24]||(e[24]=[i("编辑")])),_:1},8,["onClick"])])]),default:o(()=>[me((k(),E("div",_l,[a.ambassadorDetail?(k(),E(Ge,{key:0},[t("div",yl,[e[20]||(e[20]=t("h3",{class:"detail-title"},"基本信息",-1)),l(I,{column:1,size:"default",border:""},{default:o(()=>[l(V,{label:"ID"},{default:o(()=>[i(f(a.ambassadorDetail.id),1)]),_:1}),l(V,{label:"用户名"},{default:o(()=>[i(f(a.ambassadorDetail.username),1)]),_:1}),l(V,{label:"电子邮箱"},{default:o(()=>[i(f(a.ambassadorDetail.email||"未设置"),1)]),_:1}),l(V,{label:"电话"},{default:o(()=>[i(f(a.ambassadorDetail.phone||"未设置"),1)]),_:1}),l(V,{label:"创建时间"},{default:o(()=>[i(f(a.formatDate(a.ambassadorDetail.created_at)),1)]),_:1}),l(V,{label:"最后更新时间"},{default:o(()=>[i(f(a.formatDate(a.ambassadorDetail.updated_at)),1)]),_:1})]),_:1})]),t("div",hl,[e[21]||(e[21]=t("h3",{class:"detail-title"},"转化统计",-1)),l(I,{column:2,size:"default",border:""},{default:o(()=>[l(V,{label:"总转化数"},{default:o(()=>{var c;return[i(f(((c=a.ambassadorDetail.conversion_stats)==null?void 0:c.total_conversions)||0),1)]}),_:1}),l(V,{label:"当前营期转化数"},{default:o(()=>{var c;return[i(f(((c=a.ambassadorDetail.conversion_stats)==null?void 0:c.current_camp_conversions)||0),1)]}),_:1}),l(V,{label:"最近转化时间",span:2},{default:o(()=>{var c;return[i(f((c=a.ambassadorDetail.conversion_stats)!=null&&c.last_conversion_time?a.formatDate(a.ambassadorDetail.conversion_stats.last_conversion_time):"暂无记录"),1)]}),_:1})]),_:1})]),t("div",wl,[e[22]||(e[22]=t("h3",{class:"detail-title"},"佣金统计",-1)),l(I,{column:2,size:"default",border:""},{default:o(()=>[l(V,{label:"总佣金"},{default:o(()=>{var c;return[i(f(a.formatCurrency(((c=a.ambassadorDetail.commission_stats)==null?void 0:c.total_commission)||0))+" 元",1)]}),_:1}),l(V,{label:"当前营期佣金"},{default:o(()=>{var c;return[i(f(a.formatCurrency(((c=a.ambassadorDetail.commission_stats)==null?void 0:c.current_camp_commission)||0))+" 元",1)]}),_:1})]),_:1})])],64)):Q("",!0)])),[[z,a.detailLoading]])]),_:1},8,["modelValue"]),l(p,{title:"确认删除",modelValue:a.deleteVisible,"onUpdate:modelValue":e[10]||(e[10]=c=>a.deleteVisible=c),width:"400px","destroy-on-close":""},{footer:o(()=>[t("span",kl,[l(y,{onClick:e[9]||(e[9]=c=>a.deleteVisible=!1)},{default:o(()=>e[28]||(e[28]=[i("取消")])),_:1}),l(y,{type:"danger",onClick:a.confirmDelete,loading:a.deleting},{default:o(()=>e[29]||(e[29]=[i("确认删除")])),_:1},8,["onClick","loading"])])]),default:o(()=>{var c;return[t("div",Dl,[t("p",null,[e[25]||(e[25]=i("确定要删除推广大使 ")),t("strong",null,f((c=a.ambassadorToDelete)==null?void 0:c.username),1),e[26]||(e[26]=i(" 吗？"))]),e[27]||(e[27]=t("p",{class:"delete-warning"},"注意：只能删除没有任何推广记录的独立推广大使！",-1))])]}),_:1},8,["modelValue"])],32)}const xl=Le(dl,[["render",Vl],["__scopeId","data-v-9559f465"]]);Ia([Ua,Pa,ja,Ea,Oa,Ka,Wa]);const Sl={name:"TeamAmbassadorManagement",components:{ArrowLeft:Y(Ja),Search:Y(He),Plus:Y(Ye),MoreFilled:Y($a),Delete:Y(el),Edit:Y(al),Check:Y(ll),Close:Y(ol),Refresh:Y(qe),InfoFilled:Y(We),Money:Y(tl)},setup(){const D=r("teams"),e=r(0),O=r(null),a=r(null);let F=null,L=null;const y=r([]),h=r(!1),d=r(0),w=r(1),T=r(10),R=r(""),A=r("id"),p=r("desc"),V=r([]),I=r(0),z=r(1),c=r(10),K=r("created_at"),J=r("desc"),g=r(null),$=r(null),W=r(null),U=r(null),te=r(!1),B=r(!1),ne=r(""),P=r(!1),G=r(null),se=r(!1),ie=r(!1),oe=r(null),s=r(!1),j=r(null),fe=r(!1),ve=r(!1),v=Fe({team_name:"",leader_name:"",leader_password:"",leader_email:"",leader_phone:""}),M={team_name:[{required:!0,message:"请输入团队名称",trigger:"blur"},{min:2,max:30,message:"团队名称长度需在2到30个字符之间",trigger:"blur"}],leader_name:[{required:!0,message:"请输入领导人姓名",trigger:"blur"},{min:2,max:20,message:"领导人姓名长度需在2到20个字符之间",trigger:"blur"}],leader_password:[{required:!0,message:"请输入领导人密码",trigger:"blur"},{min:8,message:"密码长度不能少于8个字符",trigger:"blur"}],leader_email:[{type:"email",message:"请输入正确的电子邮箱格式",trigger:"blur"}],leader_phone:[{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]},b=r(!1),ee=r(null),X=r(!1),re=r(""),_e=n=>{D.value=n,n==="applications"?Z():n==="teams"?H():n==="teamDetail"&&g.value&&ce(g.value.id)},Ze=()=>{D.value==="applications"?Z():D.value==="teams"?H():D.value==="teamDetail"&&(g.value&&g.value.id?ce(g.value.id):(S.warning("无法刷新团队详情，团队信息不完整"),D.value="teams",H()))},H=async()=>{if(D.value!=="teams")return;h.value=!0;const n={page:w.value,size:T.value,sort_field:A.value,sort_order:p.value};R.value&&R.value.trim()!==""&&(n.keyword=R.value.trim()),console.log("开始请求推广大使团队列表数据，参数:",n);try{const m=await Ba(n);if(console.log("获取推广大使团队列表响应:",m),!m.data){S.warning("API返回了成功状态，但没有数据"),y.value=[],d.value=0;return}const u=m.data;if(u.records)y.value=u.records,d.value=u.total||u.records.length,w.value=u.current||w.value;else if(u.list)y.value=u.list,d.value=u.total||u.list.length,w.value=u.current||w.value;else if(Array.isArray(u))y.value=u,d.value=u.length;else{const _=Object.keys(u).filter(x=>Array.isArray(u[x])&&u[x].length>0);if(_.length>0){const x=_[0];y.value=u[x],d.value=y.value.length}else S.warning("无法识别的数据结构，显示空列表"),y.value=[],d.value=0}}catch(m){console.error("获取推广大使团队列表失败:",m),y.value=[],d.value=0}finally{h.value=!1}},Z=async()=>{if(D.value!=="applications")return;h.value=!0;const n={page:z.value,size:c.value,sort_field:K.value,sort_order:J.value};re.value&&re.value.trim()!==""&&(n.keyword=re.value.trim()),console.log("开始请求未审批晋升申请列表数据，参数:",n);try{const m=await Ee(n);if(console.log("获取未审批晋升申请列表响应:",m),!m.data){S.warning("API返回了成功状态，但没有数据"),V.value=[],I.value=0,e.value=0;return}const u=m.data;u.records?(V.value=u.records,I.value=u.total||u.records.length,z.value=u.current||z.value,e.value=u.total||u.records.length):u.list?(V.value=u.list,I.value=u.total||u.list.length,z.value=u.current||z.value,e.value=u.total||u.list.length):Array.isArray(u)?(V.value=u,I.value=u.length,e.value=u.length):(S.warning("无法识别的数据结构，显示空列表"),V.value=[],I.value=0,e.value=0)}catch(m){console.error("获取未审批晋升申请列表失败:",m),V.value=[],I.value=0,e.value=0}finally{h.value=!1}},ye=async()=>{try{const n=await Ee({page:1,size:1});n.data&&typeof n.data.total=="number"&&(e.value=n.data.total)}catch(n){console.error("获取未审批晋升申请数量失败:",n)}},Je=n=>{ne.value=n.remarks||"无备注",B.value=!0},$e=n=>{G.value=n,P.value=!0},ea=async()=>{if(G.value){se.value=!0;try{await Oe(G.value.id,"approve"),S.success("晋升申请已批准成功"),P.value=!1,Z(),D.value==="teams"&&H(),ye()}catch(n){console.error("批准晋升申请失败:",n)}finally{se.value=!1}}},aa=n=>{oe.value=n,ie.value=!0},la=async()=>{if(oe.value){s.value=!0;try{await Oe(oe.value.id,"reject"),S.success("晋升申请已拒绝"),ie.value=!1,Z(),ye()}catch(n){console.error("拒绝晋升申请失败:",n)}finally{s.value=!1}}},oa=n=>{w.value=n,H()},ta=n=>{T.value=n,w.value=1,H()},na=({prop:n,order:m})=>{A.value=n||"id",p.value=m==="ascending"?"asc":"desc",H()},sa=n=>{z.value=n,Z()},ia=n=>{c.value=n,z.value=1,Z()},ra=({prop:n,order:m})=>{K.value=n||"created_at",J.value=m==="ascending"?"asc":"desc",Z()},he=()=>{D.value==="teams"?(w.value=1,H()):D.value==="applications"&&(z.value=1,Z())};be(R,()=>{D.value==="teams"&&he()}),be(re,()=>{D.value==="applications"&&he()}),be(D,n=>{n==="applications"?Z():H()}),Re(()=>{H(),ye()});const da=()=>{F&&(F.dispose(),F=null),L&&(L.dispose(),L=null),window.removeEventListener("resize",function(){F&&F.resize()}),window.removeEventListener("resize",function(){L&&L.resize()})},Ie=async n=>{g.value=n,D.value="teamDetail",await ce(n.id)},ma=()=>{O.value&&(F&&F.dispose(),F=Ke(O.value),F.setOption({title:{text:"历史转化数据趋势",left:"center",top:5,textStyle:{fontSize:14}},tooltip:{trigger:"axis",formatter:function(n){const m=n[0].data,u=n[1].data;return`${n[0].name}<br/>
                   转化数: ${m.conversions} <br/>
                   佣金金额: ${pe(u.commission)} 元`}},legend:{data:["转化数","佣金金额"],top:"30px"},grid:{left:"3%",right:"4%",bottom:"3%",top:"60px",containLabel:!0},xAxis:{type:"category",data:[],axisTick:{alignWithLabel:!0}},yAxis:[{type:"value",name:"转化数",position:"left",minInterval:1,axisLine:{show:!0,lineStyle:{color:"#5470C6"}},axisLabel:{formatter:"{value}"},splitLine:{lineStyle:{type:"dashed"}}},{type:"value",name:"佣金金额",position:"right",axisLine:{show:!0,lineStyle:{color:"#91CC75"}},axisLabel:{formatter:"{value} 元"}}],series:[{name:"转化数",type:"line",data:[],smooth:!0,lineStyle:{width:3,color:"#5470C6"},itemStyle:{color:"#5470C6"}},{name:"佣金金额",type:"line",yAxisIndex:1,data:[],smooth:!0,lineStyle:{width:3,color:"#91CC75"},itemStyle:{color:"#91CC75"}}]}),window.addEventListener("resize",function(){F&&F.resize()}))},ua=()=>{a.value&&(L&&L.dispose(),L=Ke(a.value),L.setOption({title:{text:"团队成员转化排名",left:"center",top:5,textStyle:{fontSize:14}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(n){const m=n[0].data;return`${m.username} ${m.is_leader?"(领导人)":""}<br/>
                   转化数: ${m.conversions} <br/>
                   佣金金额: ${pe(m.commission)} 元`}},grid:{left:"3%",right:"4%",bottom:"3%",top:"60px",containLabel:!0},xAxis:{type:"value",name:"转化数",minInterval:1,axisLabel:{formatter:"{value}"},axisTick:{alignWithLabel:!0},splitLine:{lineStyle:{type:"dashed"}}},yAxis:{type:"category",data:[],axisTick:{alignWithLabel:!0},axisLabel:{formatter:function(n){return n.length>8?n.substring(0,8)+"...":n}}},series:[{name:"转化数",type:"bar",data:[],label:{show:!0,position:"right",formatter:"{c}",fontSize:12},itemStyle:{color:function(n){const m=["#ee6666","#fac858","#91cc75","#73c0de","#5470c6","#9a60b4"];return m[n.dataIndex%m.length]}}}]}),window.addEventListener("resize",function(){L&&L.resize()}))},ca=()=>{if(!F||!W.value||!W.value.history)return;const n=[...W.value.history].reverse(),m=n.map(x=>x.period_name),u=n.map(x=>({value:parseInt(x.conversions)||0,conversions:parseInt(x.conversions)||0,commission:x.commission})),_=n.map(x=>({value:parseFloat(x.commission)||0,conversions:parseInt(x.conversions)||0,commission:x.commission}));F.setOption({xAxis:{data:m},series:[{data:u},{data:_}]})},fa=()=>{if(!L||!U.value||!U.value.rankings)return;const n=[...U.value.rankings];n.sort((_,x)=>x.conversions-_.conversions);const m=n.map(_=>_.is_leader?`${_.username} (领导人)`:_.username),u=n.map(_=>({value:parseInt(_.conversions)||0,username:_.username,is_leader:_.is_leader,conversions:parseInt(_.conversions)||0,commission:_.commission}));L.setOption({yAxis:{data:m},series:[{data:u}]})},ce=async n=>{if(!n){S.warning("团队ID不存在，无法加载详情数据");return}te.value=!0,$.value=null,W.value=null,U.value=null,q.value=[];try{const[m,u,_]=await Promise.all([Qa(n),Ha(n),qa(n,{limit:25})]);$.value=m.data,W.value=u.data,U.value=_.data,U.value&&U.value.rankings&&(q.value=[...U.value.rankings]),nl(()=>{ma(),ca(),ua(),fa()})}catch(m){console.error("获取团队详情数据失败:",m),S.error("获取团队详情数据失败，请稍后重试")}finally{te.value=!1}},va=n=>{Ie(n)},pa=n=>{ee.value=n,b.value=!0},ga=async()=>{if(ee.value){X.value=!0;try{await Ya(ee.value.id),S.success("解散团队成功"),b.value=!1,H()}catch(n){console.error("解散团队失败:",n)}finally{X.value=!1}}},ba=async()=>{j.value&&j.value.validate(async n=>{if(n){ve.value=!0;try{const m={team_name:v.team_name,leader_name:v.leader_name,leader_password:v.leader_password};v.leader_email&&(m.leader_email=v.leader_email),v.leader_phone&&(m.leader_phone=v.leader_phone),await Na(m),S.success("添加团队成功"),fe.value=!1,H()}catch(m){console.error("添加团队失败:",m)}finally{ve.value=!1}}else return S.warning("请正确填写表单信息"),!1})},Ue=()=>{j.value&&j.value.resetFields(),Object.assign(v,{team_name:"",leader_name:"",leader_password:"",leader_email:"",leader_phone:""})},_a=()=>{Ue(),fe.value=!0},ya=n=>{if(!n)return"--";const m=new Date(n),u=m.getFullYear(),_=String(m.getMonth()+1).padStart(2,"0"),x=String(m.getDate()).padStart(2,"0"),ze=String(m.getHours()).padStart(2,"0"),le=String(m.getMinutes()).padStart(2,"0");return`${u}-${_}-${x} ${ze}:${le}`},pe=n=>n==null?"0.00":parseFloat(n).toFixed(2),ha=n=>{n.stopPropagation()},wa=n=>{sl.alert(`
        <div class="member-detail-dialog">
          <p><strong>用户ID:</strong> ${n.user_id}</p>
          <p><strong>用户名:</strong> ${n.username} ${n.is_leader?"(领导人)":""}</p>
          <p><strong>电子邮箱:</strong> ${n.email||"未设置"}</p>
          <p><strong>手机号码:</strong> ${n.phone||"未设置"}</p>
          <p><strong>本期转化数:</strong> ${n.conversions||0}</p>
          <p><strong>佣金金额:</strong> ${pe(n.commission)} 元</p>
        </div>
        `,`${n.username} 的详细信息`,{dangerouslyUseHTMLString:!0,confirmButtonText:"关闭",customClass:"member-detail-message-box"})},Pe=r(""),q=r([]),Ca=()=>{if(!U.value||!U.value.rankings){q.value=[];return}const n=Pe.value.toLowerCase();q.value=U.value.rankings.filter(m=>m.username.toLowerCase().includes(n))},Da=({prop:n,order:m})=>{if(!(!q.value||q.value.length===0)){if(!n||!m){q.value.sort((u,_)=>_.conversions-u.conversions);return}n==="conversions"?m==="ascending"?q.value.sort((u,_)=>(u.conversions||0)-(_.conversions||0)):m==="descending"&&q.value.sort((u,_)=>(_.conversions||0)-(u.conversions||0)):n==="commission"&&(m==="ascending"?q.value.sort((u,_)=>parseFloat(u.commission||0)-parseFloat(_.commission||0)):m==="descending"&&q.value.sort((u,_)=>parseFloat(_.commission||0)-parseFloat(u.commission||0)))}},ka=()=>{if(!g.value||!g.value.id){S.warning("请先选择团队");return}ae.username="",ae.email="",ae.phone="",ae.password="88888888",we.value=!0},Va=n=>{if(n.is_leader){S.warning("团队领导人不能被删除");return}ge.value=n,ke.value=!0},xa=async()=>{!Ce.value||!g.value||!g.value.id||Ce.value.validate(async n=>{if(n){De.value=!0;try{const m={username:ae.username,email:ae.email||void 0,phone:ae.phone||void 0,password:ae.password||"88888888"};await Ga(g.value.id,m),S.success("成员添加成功"),we.value=!1,ce(g.value.id)}catch(m){console.error("添加成员失败:",m)}finally{De.value=!1}}else return S.warning("请正确填写成员信息"),!1})},Sa=async()=>{if(!(!ge.value||!g.value||!g.value.id)){Ve.value=!0;try{await Xa(g.value.id,ge.value.user_id),S.success("成员删除成功"),ke.value=!1,ce(g.value.id)}catch(n){console.error("删除成员失败:",n)}finally{Ve.value=!1}}},we=r(!1),Ce=r(null),ae=Fe({username:"",email:"",phone:"",password:"88888888"}),Aa={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"用户名长度需在2到20个字符之间",trigger:"blur"}],email:[{type:"email",message:"请输入正确的电子邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]},De=r(!1),ke=r(!1),ge=r(null),Ve=r(!1),xe=r(!1),Se=r("佣金明细"),Ae=r(!1),Te=r(null),je=r("");return{onBeforeUnmount:da,activeTab:D,applicationCount:e,handleTabClick:_e,refreshCurrentTab:Ze,conversionChartRef:O,memberChartRef:a,searchQuery:R,handleSearch:he,teamList:y,loading:h,total:d,applicationList:V,applicationTotal:I,applicationPage:z,applicationPageSize:c,currentTeam:g,teamDetail:$,conversionHistory:W,memberRanking:U,detailLoading:te,openTeamDetail:Ie,handleViewDetails:va,remarksVisible:B,currentRemarks:ne,showApplicationRemarks:Je,approveVisible:P,applicationToApprove:G,approving:se,handleApprove:$e,confirmApprove:ea,rejectVisible:ie,applicationToReject:oe,rejecting:s,handleReject:aa,confirmReject:la,currentPage:w,pageSize:T,handleCurrentChange:oa,handleSizeChange:ta,handleSortChange:na,handleApplicationCurrentChange:sa,handleApplicationSizeChange:ia,handleApplicationSortChange:ra,loadTeamData:H,loadApplicationData:Z,formRef:j,formVisible:fe,formData:v,formRules:M,submitting:ve,handleAddTeam:_a,resetForm:Ue,submitForm:ba,formatDate:ya,formatCurrency:pe,deleteVisible:b,teamToDelete:ee,deleting:X,handleDelete:pa,confirmDelete:ga,handleWheel:ha,applicationSearchQuery:re,viewMemberDetail:wa,memberSearchKeyword:Pe,filteredMembers:q,filterMembers:Ca,handleMemberSortChange:Da,markRaw:Y,InfoFilled:We,addMemberVisible:we,memberFormRef:Ce,memberFormData:ae,memberFormRules:Aa,addingMember:De,submitMemberForm:xa,showAddMemberDialog:ka,deleteMemberVisible:ke,memberToDelete:ge,deletingMember:Ve,confirmDeleteMember:Sa,handleDeleteMember:Va,commissionDialogVisible:xe,commissionDialogTitle:Se,commissionDialogLoading:Ae,commissionData:Te,commissionType:je,showCommissionDetail:async(n,m=null)=>{var u,_;if(!g.value||!g.value.id){S.warning("团队信息不完整，无法查看佣金明细");return}Ae.value=!0,xe.value=!0,je.value=n,Te.value=null;try{let x;if(n==="leader"){if(x=(u=$.value)==null?void 0:u.leader_id,!x)throw new Error("未找到团队领导人信息");Se.value=`${((_=$.value)==null?void 0:_.leader_name)||"团队领导人"} 的佣金明细`}else if(n==="member"&&m){x=m;const de=U.value.rankings.find(Me=>Me.user_id===m);Se.value=`${(de==null?void 0:de.username)||"团队成员"} 的佣金明细`}else throw new Error("参数错误");const{getTeamMemberCommissions:ze}=await il(async()=>{const{getTeamMemberCommissions:de}=await import("./installCanvasRenderer-9PKGsH8D.js").then(Me=>Me.ah);return{getTeamMemberCommissions:de}},__vite__mapDeps([0,1,2])),le=await ze(g.value.id,x);if(le&&le.code===1&&le.data)Te.value=le.data;else{const de=(le==null?void 0:le.msg)||"获取佣金明细失败";S.warning(de)}}catch(x){console.error("获取佣金明细失败:",x),S.error("获取佣金明细失败: "+(x.message||"未知错误")),xe.value=!1}finally{Ae.value=!1}}}}},Al={key:0},Tl={class:"team-header"},zl={class:"left-section"},Ml={class:"right-section"},Fl={class:"table-card"},Ll={class:"action-buttons-group"},Rl={class:"pagination-card"},Il={key:1},Ul={class:"return-header"},Pl={class:"left-section"},jl={class:"right-section"},El={class:"table-card"},Ol={class:"action-buttons-group"},Kl={class:"pagination-card"},Wl={key:2,class:"team-detail-view"},Bl={class:"return-header"},Ql={class:"left-section"},Hl={class:"section-title"},ql={class:"right-section"},Yl={class:"detail-container"},Nl={class:"detail-card"},Gl={class:"card-header"},Xl={class:"card-header-actions"},Zl={key:0,class:"card-content"},Jl={class:"charts-row"},$l={class:"detail-card chart-card"},eo={class:"card-content"},ao={ref:"conversionChartRef",class:"chart-container"},lo={key:0,class:"empty-data"},oo={class:"detail-card chart-card"},to={class:"card-content"},no={ref:"memberChartRef",class:"chart-container"},so={key:0,class:"empty-data"},io={class:"detail-card"},ro={class:"card-header"},mo={class:"card-header-actions"},uo={class:"card-content"},co={class:"user-info"},fo={key:0,class:"leader-tag"},vo={class:"highlight-text"},po={class:"commission-text"},go={class:"action-buttons"},bo={key:0,class:"empty-data"},_o={class:"dialog-footer"},yo={class:"delete-confirm-content"},ho={class:"dialog-footer"},wo={class:"remarks-content"},Co={class:"dialog-footer"},Do={class:"approve-confirm-content"},ko={class:"dialog-footer"},Vo={class:"reject-confirm-content"},xo={class:"dialog-footer"},So={class:"dialog-footer"},Ao={class:"delete-confirm-content"},To={class:"dialog-footer"},zo={class:"commission-detail-content"},Mo={class:"commission-header"},Fo={class:"commission-period"},Lo={class:"commission-summary"},Ro={key:1},Io={class:"commission-amount"},Uo={class:"dialog-footer"};function Po(D,e,O,a,F,L){var se,ie,oe;const y=C("Refresh"),h=C("el-icon"),d=C("el-button"),w=C("Search"),T=C("el-input"),R=C("Plus"),A=C("el-badge"),p=C("el-table-column"),V=C("el-table"),I=C("el-pagination"),z=C("ArrowLeft"),c=C("InfoFilled"),K=C("el-tooltip"),J=C("Money"),g=C("el-descriptions-item"),$=C("el-descriptions"),W=C("el-empty"),U=C("el-tag"),te=C("Delete"),B=C("el-form-item"),ne=C("el-form"),P=C("el-dialog"),G=Ne("loading");return k(),E("div",{class:"team-ambassador-management",onWheel:e[32]||(e[32]=Xe(()=>{},["stop"]))},[a.activeTab==="teams"?(k(),E("div",Al,[t("div",Tl,[t("div",zl,[e[34]||(e[34]=t("h2",null,"推广大使团队管理",-1)),l(d,{type:"info",onClick:a.refreshCurrentTab,loading:a.loading},{default:o(()=>[l(h,null,{default:o(()=>[l(y)]),_:1}),e[33]||(e[33]=i(" 刷新 "))]),_:1},8,["onClick","loading"])]),t("div",Ml,[l(T,{modelValue:a.searchQuery,"onUpdate:modelValue":e[0]||(e[0]=s=>a.searchQuery=s),placeholder:"搜索团队名称/领导人名称",class:"search-input",clearable:""},{prefix:o(()=>[l(h,null,{default:o(()=>[l(w)]),_:1})]),_:1},8,["modelValue"]),l(d,{type:"primary",onClick:a.handleAddTeam},{default:o(()=>[l(h,null,{default:o(()=>[l(R)]),_:1}),e[35]||(e[35]=i(" 创建团队 "))]),_:1},8,["onClick"]),l(d,{type:"success",onClick:e[1]||(e[1]=s=>a.handleTabClick("applications")),class:ue({"has-badge":a.applicationCount>0})},{default:o(()=>[e[36]||(e[36]=i(" 晋升申请 ")),a.applicationCount>0?(k(),N(A,{key:0,value:a.applicationCount,class:"badge"},null,8,["value"])):Q("",!0)]),_:1},8,["class"])])]),t("div",Fl,[me((k(),N(V,{data:a.teamList,style:{width:"100%"},onSortChange:a.handleSortChange,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"cell-style":{padding:"12px 0"}},{default:o(()=>[l(p,{prop:"id",label:"ID",width:"80",sortable:"custom"}),l(p,{prop:"team_name",label:"团队名称",sortable:"custom"}),l(p,{prop:"leader_name",label:"领导人名称",sortable:"custom"}),l(p,{prop:"member_count",label:"成员数量",width:"120",align:"center"}),l(p,{prop:"created_at",label:"创建时间","min-width":"180",sortable:"custom"},{default:o(s=>[i(f(a.formatDate(s.row.created_at)),1)]),_:1}),l(p,{prop:"updated_at",label:"更新时间","min-width":"180"},{default:o(s=>[i(f(a.formatDate(s.row.updated_at)),1)]),_:1}),l(p,{label:"操作",width:"280",fixed:"right"},{default:o(s=>[t("div",Ll,[l(d,{type:"primary",size:"small",plain:"",onClick:j=>a.openTeamDetail(s.row)},{default:o(()=>e[37]||(e[37]=[i("查看")])),_:2},1032,["onClick"]),l(d,{type:"success",size:"small",plain:"",onClick:j=>D.handleManageMembers(s.row)},{default:o(()=>e[38]||(e[38]=[i("成员管理")])),_:2},1032,["onClick"]),l(d,{type:"danger",size:"small",plain:"",onClick:j=>a.handleDelete(s.row)},{default:o(()=>e[39]||(e[39]=[i("解散")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data","onSortChange"])),[[G,a.loading]])]),t("div",Rl,[l(I,{background:"",onSizeChange:a.handleSizeChange,onCurrentChange:a.handleCurrentChange,"current-page":a.currentPage,"page-sizes":[10,20,50],"page-size":a.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:a.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])):a.activeTab==="applications"?(k(),E("div",Il,[t("div",Ul,[t("div",Pl,[l(d,{onClick:e[2]||(e[2]=s=>a.handleTabClick("teams")),type:"primary",plain:""},{default:o(()=>[l(h,null,{default:o(()=>[l(z)]),_:1}),e[40]||(e[40]=i(" 返回 "))]),_:1}),e[41]||(e[41]=t("h2",{class:"section-title"},"晋升申请列表",-1))]),t("div",jl,[l(d,{type:"info",plain:"",onClick:a.refreshCurrentTab,loading:a.loading},{default:o(()=>[l(h,null,{default:o(()=>[l(y)]),_:1}),e[42]||(e[42]=i(" 刷新 "))]),_:1},8,["onClick","loading"]),l(T,{modelValue:a.applicationSearchQuery,"onUpdate:modelValue":e[3]||(e[3]=s=>a.applicationSearchQuery=s),placeholder:"搜索申请者用户名/ID",class:"application-search",clearable:""},{prefix:o(()=>[l(h,null,{default:o(()=>[l(w)]),_:1})]),_:1},8,["modelValue"])])]),t("div",El,[me((k(),N(V,{data:a.applicationList,style:{width:"100%"},onSortChange:a.handleApplicationSortChange,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"cell-style":{padding:"12px 0"}},{default:o(()=>[l(p,{prop:"id",label:"申请ID",width:"80",sortable:"custom"}),l(p,{prop:"user_id",label:"用户ID",width:"80",sortable:"custom"}),l(p,{prop:"user_name",label:"申请者",sortable:"custom"}),l(p,{prop:"user_email",label:"电子邮箱"},{default:o(s=>[i(f(s.row.user_email||"--"),1)]),_:1}),l(p,{prop:"user_phone",label:"电话"},{default:o(s=>[i(f(s.row.user_phone||"--"),1)]),_:1}),l(p,{prop:"expected_team_name",label:"期望团队名称"},{default:o(s=>[i(f(s.row.expected_team_name||"--"),1)]),_:1}),l(p,{prop:"created_at",label:"申请时间","min-width":"180",sortable:"custom"},{default:o(s=>[i(f(a.formatDate(s.row.created_at)),1)]),_:1}),l(p,{label:"操作",width:"220",fixed:"right"},{default:o(s=>[t("div",Ol,[l(K,{content:"查看申请备注",placement:"top","hide-after":2e3},{default:o(()=>[s.row.remarks?(k(),N(d,{key:0,type:"info",size:"small",plain:"",circle:"",onClick:j=>a.showApplicationRemarks(s.row)},{default:o(()=>[l(h,null,{default:o(()=>[l(c)]),_:1})]),_:2},1032,["onClick"])):Q("",!0)]),_:2},1024),l(d,{type:"success",size:"small",onClick:j=>a.handleApprove(s.row)},{default:o(()=>e[43]||(e[43]=[i("批准")])),_:2},1032,["onClick"]),l(d,{type:"danger",size:"small",onClick:j=>a.handleReject(s.row)},{default:o(()=>e[44]||(e[44]=[i("拒绝")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data","onSortChange"])),[[G,a.loading]])]),t("div",Kl,[l(I,{background:"",onSizeChange:a.handleApplicationSizeChange,onCurrentChange:a.handleApplicationCurrentChange,"current-page":a.applicationPage,"page-sizes":[10,20,50],"page-size":a.applicationPageSize,layout:"total, sizes, prev, pager, next, jumper",total:a.applicationTotal},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])):a.activeTab==="teamDetail"?(k(),E("div",Wl,[t("div",Bl,[t("div",Ql,[l(d,{onClick:e[4]||(e[4]=s=>a.handleTabClick("teams")),type:"primary",plain:""},{default:o(()=>[l(h,null,{default:o(()=>[l(z)]),_:1}),e[45]||(e[45]=i(" 返回团队列表 "))]),_:1}),t("h2",Hl,f(((se=a.currentTeam)==null?void 0:se.team_name)||"团队详情"),1)]),t("div",ql,[l(d,{type:"info",plain:"",onClick:a.refreshCurrentTab,loading:a.detailLoading},{default:o(()=>[l(h,null,{default:o(()=>[l(y)]),_:1}),e[46]||(e[46]=i(" 刷新 "))]),_:1},8,["onClick","loading"])])]),me((k(),E("div",Yl,[t("div",Nl,[t("div",Gl,[e[48]||(e[48]=t("h3",null,"基本信息",-1)),t("div",Xl,[l(d,{type:"primary",size:"small",onClick:e[5]||(e[5]=s=>a.showCommissionDetail("leader")),disabled:a.detailLoading,loading:a.commissionDialogLoading},{default:o(()=>[l(h,null,{default:o(()=>[l(J)]),_:1}),e[47]||(e[47]=i(" 查看领导人佣金明细 "))]),_:1},8,["disabled","loading"])])]),a.teamDetail?(k(),E("div",Zl,[l($,{column:3,border:""},{default:o(()=>[l(g,{label:"团队ID"},{default:o(()=>[i(f(a.teamDetail.team_id),1)]),_:1}),l(g,{label:"团队名称"},{default:o(()=>[i(f(a.teamDetail.team_name),1)]),_:1}),l(g,{label:"领导人ID"},{default:o(()=>[i(f(a.teamDetail.leader_id),1)]),_:1}),l(g,{label:"领导人名称"},{default:o(()=>[i(f(a.teamDetail.leader_name),1)]),_:1}),l(g,{label:"当前转化数"},{default:o(()=>[i(f(a.teamDetail.current_camp_conversions||0),1)]),_:1}),l(g,{label:"创建时间"},{default:o(()=>[i(f(a.formatDate(a.teamDetail.created_at)),1)]),_:1})]),_:1})])):Q("",!0)]),t("div",Jl,[t("div",$l,[e[49]||(e[49]=t("div",{class:"card-header"},[t("h3",null,"历史转化数据")],-1)),t("div",eo,[t("div",ao,null,512),!a.detailLoading&&(!a.conversionHistory||!((ie=a.conversionHistory.history)!=null&&ie.length))?(k(),E("div",lo,[l(W,{description:"暂无历史转化数据"})])):Q("",!0)])]),t("div",oo,[e[50]||(e[50]=t("div",{class:"card-header"},[t("h3",null,"团队成员排名")],-1)),t("div",to,[t("div",no,null,512),!a.detailLoading&&(!a.memberRanking||!((oe=a.memberRanking.rankings)!=null&&oe.length))?(k(),E("div",so,[l(W,{description:"暂无团队成员排名数据"})])):Q("",!0)])])]),t("div",io,[t("div",ro,[e[52]||(e[52]=t("h3",null,"团队成员列表",-1)),t("div",mo,[l(d,{type:"primary",size:"small",onClick:a.showAddMemberDialog,disabled:a.detailLoading},{default:o(()=>[l(h,null,{default:o(()=>[l(R)]),_:1}),e[51]||(e[51]=i(" 添加成员 "))]),_:1},8,["onClick","disabled"]),l(T,{modelValue:a.memberSearchKeyword,"onUpdate:modelValue":e[6]||(e[6]=s=>a.memberSearchKeyword=s),placeholder:"搜索成员名称",clearable:"",class:"member-search-input",onInput:a.filterMembers},{prefix:o(()=>[l(h,null,{default:o(()=>[l(w)]),_:1})]),_:1},8,["modelValue","onInput"])])]),t("div",uo,[me((k(),N(V,{data:a.filteredMembers,style:{width:"100%"},border:"",stripe:"","header-cell-style":{background:"#f5f7fa",color:"#606266"},onSortChange:a.handleMemberSortChange},{default:o(()=>[l(p,{prop:"user_id",label:"用户ID",width:"80",align:"center"}),l(p,{label:"用户名","min-width":"120"},{default:o(s=>[t("div",co,[s.row.is_leader?(k(),E("span",fo,[l(U,{type:"success",size:"small"},{default:o(()=>e[53]||(e[53]=[i("领导人")])),_:1})])):Q("",!0),t("span",null,f(s.row.username),1)])]),_:1}),l(p,{prop:"email",label:"邮箱","min-width":"180","show-overflow-tooltip":""}),l(p,{prop:"phone",label:"手机号",width:"130"}),l(p,{prop:"conversions",label:"转化数",width:"100",align:"center",sortable:"custom"},{default:o(s=>[t("span",vo,f(s.row.conversions||0),1)]),_:1}),l(p,{prop:"commission",label:"佣金金额",width:"130",align:"right",sortable:"custom"},{default:o(s=>[t("span",po,f(a.formatCurrency(s.row.commission))+" 元",1)]),_:1}),l(p,{label:"操作",width:"220",fixed:"right"},{default:o(s=>[t("div",go,[s.row.is_leader?Q("",!0):(k(),N(K,{key:0,content:"删除成员",placement:"top"},{default:o(()=>[l(d,{type:"danger",circle:"",plain:"",size:"small",onClick:j=>a.confirmDeleteMember(s.row)},{default:o(()=>[l(h,null,{default:o(()=>[l(te)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),l(K,{content:"查看佣金明细",placement:"top"},{default:o(()=>[l(d,{type:"primary",circle:"",plain:"",size:"small",onClick:j=>a.showCommissionDetail("member",s.row.user_id)},{default:o(()=>[l(h,null,{default:o(()=>[l(J)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1})]),_:1},8,["data","onSortChange"])),[[G,a.detailLoading]]),!a.detailLoading&&a.filteredMembers.length===0?(k(),E("div",bo,[l(W,{description:"未找到匹配的团队成员"})])):Q("",!0)])])])),[[G,a.detailLoading]])])):Q("",!0),l(P,{title:"添加推广大使团队",modelValue:a.formVisible,"onUpdate:modelValue":e[13]||(e[13]=s=>a.formVisible=s),width:"500px","destroy-on-close":""},{footer:o(()=>[t("span",_o,[l(d,{onClick:e[12]||(e[12]=s=>a.formVisible=!1)},{default:o(()=>e[54]||(e[54]=[i("取消")])),_:1}),l(d,{type:"primary",onClick:a.submitForm,loading:a.submitting},{default:o(()=>e[55]||(e[55]=[i("提交")])),_:1},8,["onClick","loading"])])]),default:o(()=>[l(ne,{ref:"formRef",model:a.formData,rules:a.formRules,"label-width":"120px","label-position":"right",class:"team-form"},{default:o(()=>[l(B,{label:"团队名称",prop:"team_name"},{default:o(()=>[l(T,{modelValue:a.formData.team_name,"onUpdate:modelValue":e[7]||(e[7]=s=>a.formData.team_name=s),placeholder:"请输入团队名称"},null,8,["modelValue"])]),_:1}),l(B,{label:"领导人姓名",prop:"leader_name"},{default:o(()=>[l(T,{modelValue:a.formData.leader_name,"onUpdate:modelValue":e[8]||(e[8]=s=>a.formData.leader_name=s),placeholder:"请输入领导人姓名"},null,8,["modelValue"])]),_:1}),l(B,{label:"领导人密码",prop:"leader_password"},{default:o(()=>[l(T,{modelValue:a.formData.leader_password,"onUpdate:modelValue":e[9]||(e[9]=s=>a.formData.leader_password=s),type:"password",placeholder:"请输入领导人密码","show-password":""},null,8,["modelValue"])]),_:1}),l(B,{label:"领导人电子邮箱",prop:"leader_email"},{default:o(()=>[l(T,{modelValue:a.formData.leader_email,"onUpdate:modelValue":e[10]||(e[10]=s=>a.formData.leader_email=s),placeholder:"请输入领导人电子邮箱"},null,8,["modelValue"])]),_:1}),l(B,{label:"领导人电话",prop:"leader_phone"},{default:o(()=>[l(T,{modelValue:a.formData.leader_phone,"onUpdate:modelValue":e[11]||(e[11]=s=>a.formData.leader_phone=s),placeholder:"请输入领导人电话号码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(P,{title:"确认解散团队",modelValue:a.deleteVisible,"onUpdate:modelValue":e[15]||(e[15]=s=>a.deleteVisible=s),width:"400px","destroy-on-close":""},{footer:o(()=>[t("span",ho,[l(d,{onClick:e[14]||(e[14]=s=>a.deleteVisible=!1)},{default:o(()=>e[59]||(e[59]=[i("取消")])),_:1}),l(d,{type:"danger",onClick:a.confirmDelete,loading:a.deleting},{default:o(()=>e[60]||(e[60]=[i("确认解散")])),_:1},8,["onClick","loading"])])]),default:o(()=>{var s;return[t("div",yo,[t("p",null,[e[56]||(e[56]=i("确定要解散团队 ")),t("strong",null,f((s=a.teamToDelete)==null?void 0:s.team_name),1),e[57]||(e[57]=i(" 吗？"))]),e[58]||(e[58]=t("p",{class:"delete-warning"},"注意：只能解散没有任何推广记录的团队，解散后所有成员将变为独立推广大使！",-1))])]}),_:1},8,["modelValue"]),l(P,{title:"申请备注",modelValue:a.remarksVisible,"onUpdate:modelValue":e[17]||(e[17]=s=>a.remarksVisible=s),width:"400px","destroy-on-close":""},{footer:o(()=>[t("span",Co,[l(d,{onClick:e[16]||(e[16]=s=>a.remarksVisible=!1)},{default:o(()=>e[61]||(e[61]=[i("关闭")])),_:1})])]),default:o(()=>[t("div",wo,[t("p",null,f(a.currentRemarks),1)])]),_:1},8,["modelValue"]),l(P,{title:"确认批准晋升申请",modelValue:a.approveVisible,"onUpdate:modelValue":e[19]||(e[19]=s=>a.approveVisible=s),width:"450px","destroy-on-close":""},{footer:o(()=>[t("span",ko,[l(d,{onClick:e[18]||(e[18]=s=>a.approveVisible=!1)},{default:o(()=>e[66]||(e[66]=[i("取消")])),_:1}),l(d,{type:"success",onClick:a.confirmApprove,loading:a.approving},{default:o(()=>e[67]||(e[67]=[i("确认批准")])),_:1},8,["onClick","loading"])])]),default:o(()=>{var s,j;return[t("div",Do,[t("p",null,[e[62]||(e[62]=i("确定要批准用户 ")),t("strong",null,f((s=a.applicationToApprove)==null?void 0:s.user_name),1),e[63]||(e[63]=i(" 的晋升申请吗？"))]),t("p",null,[e[64]||(e[64]=i("批准后，该用户将成为推广大使长，并创建名为 ")),t("strong",null,f(((j=a.applicationToApprove)==null?void 0:j.expected_team_name)||"(系统自动生成名称)"),1),e[65]||(e[65]=i(" 的新团队。"))])])]}),_:1},8,["modelValue"]),l(P,{title:"确认拒绝晋升申请",modelValue:a.rejectVisible,"onUpdate:modelValue":e[21]||(e[21]=s=>a.rejectVisible=s),width:"400px","destroy-on-close":""},{footer:o(()=>[t("span",xo,[l(d,{onClick:e[20]||(e[20]=s=>a.rejectVisible=!1)},{default:o(()=>e[70]||(e[70]=[i("取消")])),_:1}),l(d,{type:"danger",onClick:a.confirmReject,loading:a.rejecting},{default:o(()=>e[71]||(e[71]=[i("确认拒绝")])),_:1},8,["onClick","loading"])])]),default:o(()=>{var s;return[t("div",Vo,[t("p",null,[e[68]||(e[68]=i("确定要拒绝用户 ")),t("strong",null,f((s=a.applicationToReject)==null?void 0:s.user_name),1),e[69]||(e[69]=i(" 的晋升申请吗？"))])])]}),_:1},8,["modelValue"]),l(P,{title:"添加团队成员",modelValue:a.addMemberVisible,"onUpdate:modelValue":e[27]||(e[27]=s=>a.addMemberVisible=s),width:"400px","destroy-on-close":""},{footer:o(()=>[t("span",So,[l(d,{onClick:e[26]||(e[26]=s=>a.addMemberVisible=!1)},{default:o(()=>e[72]||(e[72]=[i("取消")])),_:1}),l(d,{type:"primary",onClick:a.submitMemberForm,loading:a.addingMember},{default:o(()=>e[73]||(e[73]=[i("添加")])),_:1},8,["onClick","loading"])])]),default:o(()=>[l(ne,{ref:"memberFormRef",model:a.memberFormData,rules:a.memberFormRules,"label-width":"100px","label-position":"right",class:"member-form"},{default:o(()=>[l(B,{label:"用户名",prop:"username"},{default:o(()=>[l(T,{modelValue:a.memberFormData.username,"onUpdate:modelValue":e[22]||(e[22]=s=>a.memberFormData.username=s),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),l(B,{label:"电子邮箱",prop:"email"},{default:o(()=>[l(T,{modelValue:a.memberFormData.email,"onUpdate:modelValue":e[23]||(e[23]=s=>a.memberFormData.email=s),placeholder:"请输入电子邮箱"},null,8,["modelValue"])]),_:1}),l(B,{label:"手机号码",prop:"phone"},{default:o(()=>[l(T,{modelValue:a.memberFormData.phone,"onUpdate:modelValue":e[24]||(e[24]=s=>a.memberFormData.phone=s),placeholder:"请输入手机号码"},null,8,["modelValue"])]),_:1}),l(B,{label:"密码",prop:"password"},{default:o(()=>[l(T,{modelValue:a.memberFormData.password,"onUpdate:modelValue":e[25]||(e[25]=s=>a.memberFormData.password=s),type:"password",placeholder:"默认密码: 88888888","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(P,{title:"确认删除成员",modelValue:a.deleteMemberVisible,"onUpdate:modelValue":e[29]||(e[29]=s=>a.deleteMemberVisible=s),width:"400px","destroy-on-close":""},{footer:o(()=>[t("span",To,[l(d,{onClick:e[28]||(e[28]=s=>a.deleteMemberVisible=!1)},{default:o(()=>e[77]||(e[77]=[i("取消")])),_:1}),l(d,{type:"danger",onClick:a.confirmDeleteMember,loading:a.deletingMember},{default:o(()=>e[78]||(e[78]=[i("确认删除")])),_:1},8,["onClick","loading"])])]),default:o(()=>{var s;return[t("div",Ao,[t("p",null,[e[74]||(e[74]=i("确定要删除成员 ")),t("strong",null,f((s=a.memberToDelete)==null?void 0:s.username),1),e[75]||(e[75]=i(" 吗？"))]),e[76]||(e[76]=t("p",{class:"delete-warning"},"注意：删除后将无法恢复！",-1))])]}),_:1},8,["modelValue"]),l(P,{title:a.commissionDialogTitle,modelValue:a.commissionDialogVisible,"onUpdate:modelValue":e[31]||(e[31]=s=>a.commissionDialogVisible=s),width:"700px","destroy-on-close":""},{footer:o(()=>[t("span",Uo,[l(d,{onClick:e[30]||(e[30]=s=>a.commissionDialogVisible=!1)},{default:o(()=>e[90]||(e[90]=[i("关闭")])),_:1})])]),default:o(()=>[me((k(),E("div",zo,[a.commissionData?(k(),E(Ge,{key:0},[t("div",Mo,[t("div",Fo,[e[83]||(e[83]=t("h4",null,"营期信息",-1)),t("p",null,[e[79]||(e[79]=t("strong",null,"营期ID:",-1)),i(" "+f(a.commissionData.camp_id),1)]),t("p",null,[e[80]||(e[80]=t("strong",null,"营期名称:",-1)),i(" "+f(a.commissionData.camp_name),1)]),t("p",null,[e[81]||(e[81]=t("strong",null,"开始时间:",-1)),i(" "+f(a.formatDate(a.commissionData.start_date)),1)]),t("p",null,[e[82]||(e[82]=t("strong",null,"结束时间:",-1)),i(" "+f(a.formatDate(a.commissionData.end_date)),1)])]),t("div",Lo,[e[88]||(e[88]=t("h4",null,"统计信息",-1)),t("p",null,[e[84]||(e[84]=t("strong",null,"用户ID:",-1)),i(" "+f(a.commissionData.user_id),1)]),t("p",null,[e[85]||(e[85]=t("strong",null,"用户名:",-1)),i(" "+f(a.commissionData.username),1)]),t("p",null,[e[86]||(e[86]=t("strong",null,"总转化数:",-1)),i(" "+f(a.commissionData.conversion_count||0),1)]),t("p",null,[e[87]||(e[87]=t("strong",null,"总佣金:",-1)),i(" "+f(a.formatCurrency(a.commissionData.total_commission))+" 元",1)])])]),e[89]||(e[89]=t("h4",{class:"detail-title"},"佣金明细列表",-1)),l(V,{data:a.commissionData.details||[],style:{width:"100%"},border:"",stripe:"","max-height":"350px","header-cell-style":{background:"#f5f7fa",color:"#606266"}},{default:o(()=>[l(p,{prop:"commission_id",label:"ID",width:"70",align:"center"}),l(p,{label:"佣金类型","min-width":"120"},{default:o(s=>[i(f(D.formatCommissionType(s.row.commission_type)),1)]),_:1}),l(p,{label:"客户ID","min-width":"80",align:"center"},{default:o(s=>[i(f(s.row.customer_id||"-"),1)]),_:1}),l(p,{label:"层级",width:"80",align:"center"},{default:o(s=>[s.row.tier?(k(),N(U,{key:0,size:"small"},{default:o(()=>[i(f(s.row.tier),1)]),_:2},1024)):(k(),E("span",Ro,"-"))]),_:1}),l(p,{prop:"commission_amount",label:"佣金金额",width:"120",align:"right"},{default:o(s=>[t("span",Io,f(a.formatCurrency(s.row.commission_amount))+" 元",1)]),_:1}),l(p,{prop:"created_time",label:"创建时间","min-width":"150"},{default:o(s=>[i(f(a.formatDate(s.row.created_time)),1)]),_:1})]),_:1},8,["data"]),!a.commissionData.details||a.commissionData.details.length===0?(k(),N(W,{key:0,description:"暂无佣金明细"})):Q("",!0)],64)):a.commissionDialogLoading?Q("",!0):(k(),N(W,{key:1,description:"未找到佣金明细数据"}))])),[[G,a.commissionDialogLoading]])]),_:1},8,["title","modelValue"])],32)}const jo=Le(Sl,[["render",Po],["__scopeId","data-v-65a5e661"]]),Eo={class:"ambassador-management"},Oo={class:"content-container"},Ko={class:"side-nav"},Wo={class:"nav-container"},Bo={class:"nav-steps"},Qo={class:"step-line-container"},Ho={class:"fullpage-wrapper"},qo={class:"content-area"},Yo={class:"content-area"},Be=2,Qe=800,No=1500,Go={__name:"AmbassadorManagement",setup(D){const e=r(1),O=r(null),a=r(!1),F=r(!1);be(e,()=>{F.value=!0,setTimeout(()=>{F.value=!1},No)});const L=d=>{e.value!==d&&(e.value=d)},y=d=>{a.value||(a.value=!0,setTimeout(()=>{a.value=!1},Qe),d.deltaY>0?e.value<Be-1&&e.value++:d.deltaY<0&&e.value>0&&e.value--)},h=d=>{a.value||(a.value=!0,setTimeout(()=>{a.value=!1},Qe),d.key==="ArrowDown"||d.key==="PageDown"?(e.value<Be-1&&e.value++,d.preventDefault()):(d.key==="ArrowUp"||d.key==="PageUp")&&(e.value>0&&e.value--,d.preventDefault()))};return Re(()=>{console.log("管理员推广大使管理页面已加载"),window.addEventListener("wheel",y,{passive:!1}),window.addEventListener("keydown",h)}),rl(()=>{window.removeEventListener("wheel",y),window.removeEventListener("keydown",h)}),(d,w)=>(k(),E("div",Eo,[l(Ta,{activePage:"ambassador"}),t("div",Oo,[t("div",{class:"main-layout",ref_key:"fullpageContainer",ref:O},[t("div",Ko,[t("div",Wo,[t("div",Bo,[t("div",{class:ue(["step-item",{active:e.value===0}]),onClick:w[0]||(w[0]=T=>L(0))},w[2]||(w[2]=[t("div",{class:"step-icon individual"},[t("i",{class:"el-icon-user"})],-1),t("div",{class:"step-label"},"独立大使",-1)]),2),t("div",Qo,[w[3]||(w[3]=t("div",{class:"step-line-bg"},null,-1)),t("div",{class:ue(["step-line-active",{"individual-active":e.value===0,"team-active":e.value===1,"transition-animation":F.value}])},null,2)]),t("div",{class:ue(["step-item",{active:e.value===1}]),onClick:w[1]||(w[1]=T=>L(1))},w[4]||(w[4]=[t("div",{class:"step-icon team"},[t("i",{class:"el-icon-user-solid"})],-1),t("div",{class:"step-label"},"团队管理",-1)]),2)])])]),t("div",Ho,[t("div",{class:ue(["fullpage-section",{active:e.value===0}])},[t("div",qo,[l(xl)])],2),t("div",{class:ue(["fullpage-section",{active:e.value===1}])},[t("div",Yo,[e.value===1?(k(),N(jo,{key:0})):Q("",!0)])],2)])],512)])]))}},et=Le(Go,[["__scopeId","data-v-51300677"]]);export{et as default};
