import{s as S,r as w,a as N,o as j,k as q,c as W,b as t,d as i,w as d,x as B,l as z,E as m,z as H,D as O,f as u,y as G,g as T,h as v,t as k,i as J}from"./index-nCsIEKc5.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";function Q(){return S({url:"/api/user/profile",method:"get"})}function Z(h){return S({url:"/api/user/profile",method:"put",data:h})}const $={name:"UserProfile",setup(){const h=J(),e=w(null),y=w(!0),s=w(!1),C=w(null);let x=null;const c=w({id:"",username:"",email:"",phone:"",role:""}),a=N({email:"",phone:"",password:""}),F={email:[{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}],password:[{min:6,message:"密码长度不能少于6位",trigger:"blur"}]},_=()=>{const o=C.value;if(!o)return;const n=o.getContext("2d"),l=[],P=()=>{const r=o.parentElement;o.width=r.offsetWidth,o.height=r.offsetHeight};window.addEventListener("resize",P),P();class L{constructor(){this.x=Math.random()*o.width,this.y=Math.random()*o.height,this.size=Math.random()*3+1,this.speedX=Math.random()*1-.5,this.speedY=Math.random()*1-.5,this.color=`rgba(64, 158, 255, ${Math.random()*.5+.1})`}update(){(this.x>o.width||this.x<0)&&(this.speedX=-this.speedX),(this.y>o.height||this.y<0)&&(this.speedY=-this.speedY),this.x+=this.speedX,this.y+=this.speedY}draw(){n.fillStyle=this.color,n.beginPath(),n.arc(this.x,this.y,this.size,0,Math.PI*2),n.fill()}}const X=()=>{for(let r=0;r<15;r++)l.push(new L)},U=()=>{n.clearRect(0,0,o.width,o.height),l.forEach(r=>{r.update(),r.draw()}),Y(),x=requestAnimationFrame(U)},Y=()=>{for(let r=0;r<l.length;r++)for(let g=r+1;g<l.length;g++){const D=l[r].x-l[g].x,E=l[r].y-l[g].y,R=Math.sqrt(D*D+E*E);R<100&&(n.beginPath(),n.strokeStyle=`rgba(64, 158, 255, ${.2-R/500})`,n.lineWidth=.8,n.moveTo(l[r].x,l[r].y),n.lineTo(l[g].x,l[g].y),n.stroke())}};return X(),U(),()=>{window.removeEventListener("resize",P),x&&cancelAnimationFrame(x)}},f=async()=>{y.value=!0;try{const o=await Q();o.code===1&&o.data?(c.value=o.data,a.email=o.data.email||"",a.phone=o.data.phone||"",a.password=""):m.error("获取用户信息失败")}catch(o){console.error("获取用户信息错误:",o),m.error("获取用户信息失败")}finally{y.value=!1}},M=()=>{e.value&&e.value.validate(async o=>{if(o){s.value=!0;const n={};if(a.email!==c.value.email&&(n.email=a.email),a.phone!==c.value.phone&&(n.phone=a.phone),a.password&&(n.password=a.password),Object.keys(n).length===0){m.info("没有修改任何内容"),s.value=!1;return}try{const l=await Z(n);l.code===1?(m.success("个人信息更新成功"),c.value={...c.value,...l.data},a.password=""):m.error(l.msg||"更新失败")}catch(l){console.error("更新用户信息错误:",l),m.error("更新用户信息失败")}finally{s.value=!1}}else m.warning("请正确填写表单")})},V=()=>{a.email=c.value.email||"",a.phone=c.value.phone||"",a.password="",e.value&&e.value.clearValidate()},I=()=>{H.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await O(),localStorage.removeItem("token"),h.push("/login"),m.success("退出登录成功")}catch(o){console.error("退出登录错误:",o),localStorage.removeItem("token"),h.push("/login"),m.warning("登出请求失败，但已清除本地登录状态")}}).catch(()=>{})},b=()=>{h.push("/dashboard")},p=o=>({admin:"danger",ambassador:"success",brand:"warning",user:"info"})[o]||"info",A=o=>({admin:"管理员",ambassador:"大使",brand:"品牌方",user:"普通用户"})[o]||"未知角色";return j(()=>{f();const o=_();q(()=>{o&&o()})}),{formRef:e,welcomeCanvas:C,loading:y,submitting:s,userInfo:c,userForm:a,rules:F,submitForm:M,resetForm:V,logout:I,goToDashboard:b,getRoleTagType:p,getRoleLabel:A}}},ee={class:"user-profile-container"},oe={class:"header"},te={class:"navigation-actions"},se={class:"main-content"},ae={class:"welcome-section"},ne={ref:"welcomeCanvas",class:"welcome-canvas"},le={class:"header-actions"},re={style:{padding:"20px"}},ie={class:"user-info-container"},de={class:"user-basic-info"},ce={class:"user-avatar"},me={class:"avatar-circle"},ue={class:"user-details"},pe={class:"username"},he={class:"user-id"},fe={class:"user-role"},ge={class:"form-section"};function ve(h,e,y,s,C,x){const c=u("el-button"),a=u("el-skeleton-item"),F=u("el-tag"),_=u("el-input"),f=u("el-form-item"),M=u("el-form"),V=u("el-skeleton"),I=u("el-card"),b=G("loading");return T(),W("div",ee,[t("div",oe,[e[4]||(e[4]=t("div",{class:"logo"},"营销推广管理系统",-1)),t("div",te,[i(c,{class:"back-btn",onClick:s.goToDashboard,type:"primary",plain:""},{default:d(()=>e[3]||(e[3]=[t("i",{class:"el-icon-back"},null,-1),v(" 返回首页 ")])),_:1},8,["onClick"])])]),t("div",se,[t("div",ae,[t("canvas",ne,null,512),e[6]||(e[6]=t("h2",{class:"welcome-text"},"个人中心",-1)),t("div",le,[i(c,{type:"danger",onClick:s.logout},{default:d(()=>e[5]||(e[5]=[v("退出登录")])),_:1},8,["onClick"])])]),B((T(),z(I,{class:"profile-card"},{header:d(()=>e[7]||(e[7]=[t("div",{class:"card-header"},[t("span",null,[t("i",{class:"el-icon-user"}),v(" 个人信息")])],-1)])),default:d(()=>[i(V,{loading:s.loading,animated:""},{template:d(()=>[t("div",re,[i(a,{variant:"text",style:{width:"100%",height:"40px"}}),i(a,{variant:"text",style:{"margin-top":"20px",width:"100%",height:"40px"}}),i(a,{variant:"text",style:{"margin-top":"20px",width:"100%",height:"40px"}}),i(a,{variant:"text",style:{"margin-top":"20px",width:"100%",height:"40px"}})])]),default:d(()=>[t("div",ie,[t("div",de,[t("div",ce,[t("div",me,[t("span",null,k(s.userInfo.username?s.userInfo.username.charAt(0).toUpperCase():"U"),1)])]),t("div",ue,[t("h3",pe,k(s.userInfo.username||"用户名"),1),t("div",he,"ID: "+k(s.userInfo.id||"--"),1),t("div",fe,[i(F,{type:s.getRoleTagType(s.userInfo.role)},{default:d(()=>[v(k(s.getRoleLabel(s.userInfo.role)),1)]),_:1},8,["type"])])])]),e[14]||(e[14]=t("div",{class:"section-divider"},null,-1)),t("div",ge,[e[13]||(e[13]=t("h3",{class:"section-title"},"编辑信息",-1)),B((T(),z(M,{ref:"formRef",model:s.userForm,rules:s.rules,"label-width":"100px",class:"edit-form"},{default:d(()=>[i(f,{label:"邮箱",prop:"email"},{default:d(()=>[i(_,{modelValue:s.userForm.email,"onUpdate:modelValue":e[0]||(e[0]=p=>s.userForm.email=p),placeholder:"请输入邮箱"},{prefix:d(()=>e[8]||(e[8]=[t("i",{class:"el-icon-message"},null,-1)])),_:1},8,["modelValue"])]),_:1}),i(f,{label:"手机号",prop:"phone"},{default:d(()=>[i(_,{modelValue:s.userForm.phone,"onUpdate:modelValue":e[1]||(e[1]=p=>s.userForm.phone=p),placeholder:"请输入手机号"},{prefix:d(()=>e[9]||(e[9]=[t("i",{class:"el-icon-mobile-phone"},null,-1)])),_:1},8,["modelValue"])]),_:1}),i(f,{label:"修改密码",prop:"password"},{default:d(()=>[i(_,{modelValue:s.userForm.password,"onUpdate:modelValue":e[2]||(e[2]=p=>s.userForm.password=p),type:"password",placeholder:"输入新密码，不修改请留空","show-password":""},{prefix:d(()=>e[10]||(e[10]=[t("i",{class:"el-icon-lock"},null,-1)])),_:1},8,["modelValue"])]),_:1}),i(f,{class:"form-actions"},{default:d(()=>[i(c,{type:"primary",onClick:s.submitForm,loading:s.submitting},{default:d(()=>e[11]||(e[11]=[t("i",{class:"el-icon-check"},null,-1),v(" 保存修改 ")])),_:1},8,["onClick","loading"]),i(c,{onClick:s.resetForm},{default:d(()=>e[12]||(e[12]=[t("i",{class:"el-icon-refresh-right"},null,-1),v(" 重置 ")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])),[[b,s.submitting]])])])]),_:1},8,["loading"])]),_:1})),[[b,s.loading]])])])}const ye=K($,[["render",ve],["__scopeId","data-v-64c95607"]]);export{ye as default};
