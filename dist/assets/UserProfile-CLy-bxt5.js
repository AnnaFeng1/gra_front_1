import{s as N,_ as Y,L as j,r as w,a as q,o as W,j as H,c as O,d as i,b as s,w as d,v as z,k as D,E as m,C as G,f as u,z as J,g as B,h as y,t as F,u as K}from"./index-Bt0verpb.js";import{a as Q}from"./auth-C0OuI9IS.js";function Z(){return N({url:"/api/user/profile",method:"get"})}function $(h){return N({url:"/api/user/profile",method:"put",data:h})}const ee={name:"UserProfile",components:{LeaderNavBar:j},setup(){const h=K(),e=w(null),x=w(!0),t=w(!1),M=w(null);let b=null;const c=w({id:"",username:"",email:"",phone:"",role:""}),n=q({email:"",phone:"",password:""}),f={email:[{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}],password:[{min:6,message:"密码长度不能少于6位",trigger:"blur"}]},C=()=>{const o=M.value;if(!o)return;const a=o.getContext("2d"),r=[],U=()=>{const l=o.parentElement;o.width=l.offsetWidth,o.height=l.offsetHeight};window.addEventListener("resize",U),U();class S{constructor(){this.x=Math.random()*o.width,this.y=Math.random()*o.height,this.size=Math.random()*3+1,this.speedX=Math.random()*1-.5,this.speedY=Math.random()*1-.5,this.color=`rgba(64, 158, 255, ${Math.random()*.5+.1})`}update(){(this.x>o.width||this.x<0)&&(this.speedX=-this.speedX),(this.y>o.height||this.y<0)&&(this.speedY=-this.speedY),this.x+=this.speedX,this.y+=this.speedY}draw(){a.fillStyle=this.color,a.beginPath(),a.arc(this.x,this.y,this.size,0,Math.PI*2),a.fill()}}const A=()=>{for(let l=0;l<15;l++)r.push(new S)},T=()=>{a.clearRect(0,0,o.width,o.height),r.forEach(l=>{l.update(),l.draw()}),X(),b=requestAnimationFrame(T)},X=()=>{for(let l=0;l<r.length;l++)for(let v=l+1;v<r.length;v++){const E=r[l].x-r[v].x,L=r[l].y-r[v].y,R=Math.sqrt(E*E+L*L);R<100&&(a.beginPath(),a.strokeStyle=`rgba(64, 158, 255, ${.2-R/500})`,a.lineWidth=.8,a.moveTo(r[l].x,r[l].y),a.lineTo(r[v].x,r[v].y),a.stroke())}};return A(),T(),()=>{window.removeEventListener("resize",U),b&&cancelAnimationFrame(b)}},_=async()=>{x.value=!0;try{const o=await Z();o.code===1&&o.data?(c.value=o.data,n.email=o.data.email||"",n.phone=o.data.phone||"",n.password=""):m.error("获取用户信息失败")}catch(o){console.error("获取用户信息错误:",o),m.error("获取用户信息失败")}finally{x.value=!1}},g=()=>{e.value&&e.value.validate(async o=>{if(o){t.value=!0;const a={};if(n.email!==c.value.email&&(a.email=n.email),n.phone!==c.value.phone&&(a.phone=n.phone),n.password&&(a.password=n.password),Object.keys(a).length===0){m.info("没有修改任何内容"),t.value=!1;return}try{const r=await $(a);r.code===1?(m.success("个人信息更新成功"),c.value={...c.value,...r.data},n.password=""):m.error(r.msg||"更新失败")}catch(r){console.error("更新用户信息错误:",r),m.error("更新用户信息失败")}finally{t.value=!1}}else m.warning("请正确填写表单")})},P=()=>{n.email=c.value.email||"",n.phone=c.value.phone||"",n.password="",e.value&&e.value.clearValidate()},V=()=>{G.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Q(),localStorage.removeItem("token"),h.push("/login"),m.success("退出登录成功")}catch(o){console.error("退出登录错误:",o),localStorage.removeItem("token"),h.push("/login"),m.warning("登出请求失败，但已清除本地登录状态")}}).catch(()=>{})},I=()=>{h.push("/dashboard")},k=o=>({admin:"danger",ambassador:"success",brand:"warning",user:"info"})[o]||"info",p=o=>({admin:"管理员",ambassador:"大使",brand:"品牌方",user:"普通用户"})[o]||"未知角色";return W(()=>{_();const o=C();H(()=>{o&&o()})}),{formRef:e,welcomeCanvas:M,loading:x,submitting:t,userInfo:c,userForm:n,rules:f,submitForm:g,resetForm:P,logout:V,goToDashboard:I,getRoleTagType:k,getRoleLabel:p}}},oe={class:"user-profile-container"},te={class:"main-content"},se={class:"welcome-section"},ae={ref:"welcomeCanvas",class:"welcome-canvas"},ne={class:"header-actions"},re={style:{padding:"20px"}},le={class:"user-info-container"},ie={class:"user-basic-info"},de={class:"user-avatar"},ce={class:"avatar-circle"},me={class:"user-details"},ue={class:"username"},pe={class:"user-id"},he={class:"user-role"},fe={class:"form-section"};function ge(h,e,x,t,M,b){const c=u("LeaderNavBar"),n=u("el-button"),f=u("el-skeleton-item"),C=u("el-tag"),_=u("el-input"),g=u("el-form-item"),P=u("el-form"),V=u("el-skeleton"),I=u("el-card"),k=J("loading");return B(),O("div",oe,[i(c,{activePage:"profile"}),s("div",te,[s("div",se,[s("canvas",ae,null,512),e[4]||(e[4]=s("h2",{class:"welcome-text"},"个人中心",-1)),s("div",ne,[i(n,{type:"danger",onClick:t.logout},{default:d(()=>e[3]||(e[3]=[y("退出登录")])),_:1},8,["onClick"])])]),z((B(),D(I,{class:"profile-card"},{header:d(()=>e[5]||(e[5]=[s("div",{class:"card-header"},[s("span",null,[s("i",{class:"el-icon-user"}),y(" 个人信息")])],-1)])),default:d(()=>[i(V,{loading:t.loading,animated:""},{template:d(()=>[s("div",re,[i(f,{variant:"text",style:{width:"100%",height:"40px"}}),i(f,{variant:"text",style:{"margin-top":"20px",width:"100%",height:"40px"}}),i(f,{variant:"text",style:{"margin-top":"20px",width:"100%",height:"40px"}}),i(f,{variant:"text",style:{"margin-top":"20px",width:"100%",height:"40px"}})])]),default:d(()=>[s("div",le,[s("div",ie,[s("div",de,[s("div",ce,[s("span",null,F(t.userInfo.username?t.userInfo.username.charAt(0).toUpperCase():"U"),1)])]),s("div",me,[s("h3",ue,F(t.userInfo.username||"用户名"),1),s("div",pe,"ID: "+F(t.userInfo.id||"--"),1),s("div",he,[i(C,{type:t.getRoleTagType(t.userInfo.role)},{default:d(()=>[y(F(t.getRoleLabel(t.userInfo.role)),1)]),_:1},8,["type"])])])]),e[12]||(e[12]=s("div",{class:"section-divider"},null,-1)),s("div",fe,[e[11]||(e[11]=s("h3",{class:"section-title"},"编辑信息",-1)),z((B(),D(P,{ref:"formRef",model:t.userForm,rules:t.rules,"label-width":"100px",class:"edit-form"},{default:d(()=>[i(g,{label:"邮箱",prop:"email"},{default:d(()=>[i(_,{modelValue:t.userForm.email,"onUpdate:modelValue":e[0]||(e[0]=p=>t.userForm.email=p),placeholder:"请输入邮箱"},{prefix:d(()=>e[6]||(e[6]=[s("i",{class:"el-icon-message"},null,-1)])),_:1},8,["modelValue"])]),_:1}),i(g,{label:"手机号",prop:"phone"},{default:d(()=>[i(_,{modelValue:t.userForm.phone,"onUpdate:modelValue":e[1]||(e[1]=p=>t.userForm.phone=p),placeholder:"请输入手机号"},{prefix:d(()=>e[7]||(e[7]=[s("i",{class:"el-icon-mobile-phone"},null,-1)])),_:1},8,["modelValue"])]),_:1}),i(g,{label:"修改密码",prop:"password"},{default:d(()=>[i(_,{modelValue:t.userForm.password,"onUpdate:modelValue":e[2]||(e[2]=p=>t.userForm.password=p),type:"password",placeholder:"输入新密码，不修改请留空","show-password":""},{prefix:d(()=>e[8]||(e[8]=[s("i",{class:"el-icon-lock"},null,-1)])),_:1},8,["modelValue"])]),_:1}),i(g,{class:"form-actions"},{default:d(()=>[i(n,{type:"primary",onClick:t.submitForm,loading:t.submitting},{default:d(()=>e[9]||(e[9]=[s("i",{class:"el-icon-check"},null,-1),y(" 保存修改 ")])),_:1},8,["onClick","loading"]),i(n,{onClick:t.resetForm},{default:d(()=>e[10]||(e[10]=[s("i",{class:"el-icon-refresh-right"},null,-1),y(" 重置 ")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])),[[k,t.submitting]])])])]),_:1},8,["loading"])]),_:1})),[[k,t.loading]])])])}const we=Y(ee,[["render",ge],["__scopeId","data-v-3336e083"]]);export{we as default};
